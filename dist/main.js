(()=>{"use strict";const e=(()=>{const e=document.querySelector(".P1"),t=document.querySelector(".P2"),s=document.querySelector(".sample");let a="PLAY";const r=e=>{const t=e.split(" ");return{x:+t[0],y:+t[1]}},d=()=>{t.classList.add("active")};return d(),{init:d,renderGameboard:(d,c,n)=>{let l="P1"===d?e:t;"sample"===d?(l=s,a="PLACE"):a="PLAY",l.textContent="",l.classList.add(c),n.forEach((e=>l.appendChild((e=>{const t=document.createElement("div");return t.classList.add("cell"),t.setAttribute("data-coords",`${e.coords.x} ${e.coords.y}`),e.hasShip&&t.classList.add("ship"),(e=>{"PLACE"===a&&(e.addEventListener("click",(()=>{o.placeShip(r(e.getAttribute("data-coords")))})),e.addEventListener("mouseover",(()=>{o.showShip(r(e.getAttribute("data-coords")))}))),e.addEventListener("click",(()=>{i.playTurn(r(e.getAttribute("data-coords")))}))})(t),t})(e))))},cellHit:e=>{const t=`${e.x} ${e.y}`;document.querySelector(`.active > [data-coords="${t}"]`).classList.add("hit")},shipSunk:e=>{e.forEach((e=>{document.querySelector(`.active > [data-coords="${e.x} ${e.y}"]`).classList.add("sunk")}))},toggleActiveBoard:()=>{e.classList.toggle("active"),t.classList.toggle("active")}}})(),t=t=>{const s=[],a=(e=>{const t=[];for(let s=0;s<e*e;s++)t.push({coords:{x:s%e,y:Math.floor(s/e)},hasShip:"",isShot:!1});return t})(t),r=e=>a[e.x+e.y*t];return{at:r,isValidAttack:e=>!r(e).isShot,isShipHit:e=>""!==r(e).hasShip,receiveAttack:t=>{const i=r(t);if(i.isShot=!0,e.cellHit(t),i.hasShip){const t=s.find((e=>e.name===i.hasShip));t.hit(),t.isSunk()&&(t=>{console.log(t);const s=a.filter((e=>e.hasShip===t)).map((e=>e.coords));e.shipSunk(s)})(t.name)}},setShip:(e,t,a="x")=>{s.push(e);let i=t;for(let t=0;t<e.getLength();t++)r(i).hasShip=e.name,"x"===a?i.x++:i.y++},isCollisions:e=>{for(const s of e){if(s.x>t-1||s.y>t-1)return!0;if(""!==r(s).hasShip)return!0}return!1},getBoard:()=>a}},s=e=>({name:e,gameboard:t(10),isActive:!1}),a=(e,t)=>{const s=e;let a=0;return{name:t,getLength:()=>s,getHits:()=>a,hit:()=>{a++},isSunk:()=>s===a}},r=e=>{const t=e.filter((e=>!e.isShot));return t[Math.floor(Math.random()*t.length)].coords},i=(()=>{const t=s("player"),i=s("enemy"),d=()=>t.isActive?i:t,c=s=>{const a=d().gameboard;a.isValidAttack(s)&&(a.receiveAttack(s),a.isShipHit(s)||(t.isActive=!t.isActive,i.isActive=!i.isActive,e.toggleActiveBoard()),n())},n=async()=>{i.isActive&&(await(300,new Promise((e=>setTimeout(e,300)))),c(r(d().gameboard.getBoard())))};return{init:()=>{t.isActive=!0,t.gameboard=o.getSamplePlayer().gameboard,e.renderGameboard("P1",t.name,t.gameboard.getBoard()),(()=>{i.isActive=!1;let t=[a(3,"enemya"),a(2,"enemyb")];i.gameboard.setShip(t[0],{x:1,y:1},"x"),i.gameboard.setShip(t[1],{x:2,y:5},"y"),e.renderGameboard("P2",i.name,i.gameboard.getBoard())})()},playTurn:c}})(),o=(()=>{const t=s("sample"),r=[a(4,"ak"),a(2,"b"),a(5,"c"),a(4,"d"),a(2,"e")];let o={shipNum:0,shipCoordsArray:[],axis:"x"};const d=document.querySelector(".modal"),c=e=>document.querySelector(`[data-coords="${e.x} ${e.y}"]`),n=e=>{0!==o.shipCoordsArray.length&&o.shipCoordsArray.forEach((e=>{c(e).classList.remove("temp"),c(e).classList.remove("invalid")})),o.shipCoordsArray=l(e),o.shipCoordsArray.forEach((e=>{c(e).classList.add("temp")})),h()||o.shipCoordsArray.forEach((e=>{c(e).classList.add("invalid")}))},l=e=>{let t=[],s=e;for(let e=0;e<r[o.shipNum].getLength()&&(t.push({x:s.x,y:s.y}),"x"===o.axis?s.x++:s.y++,!(s.x>9||s.y>9));e++);return t},h=()=>!t.gameboard.isCollisions(o.shipCoordsArray)&&o.shipCoordsArray.length===r[o.shipNum].getLength();return{init:()=>{e.renderGameboard("sample",t.name,t.gameboard.getBoard()),document.addEventListener("keyup",(({key:e})=>{"R"!==e&&"r"!==e||(o.axis="x"===o.axis?"y":"x",n(o.shipCoordsArray[0],o.axis))}))},placeShip:s=>{h()&&(t.gameboard.setShip(r[o.shipNum++],s,o.axis),o.shipCoordsArray.forEach((e=>c(e).classList.add("ship"))),e.renderGameboard("sample",t.name,t.gameboard.getBoard()),o.shipNum===r.length&&(d.remove(),i.init()))},showShip:n,getSamplePlayer:()=>t}})();o.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBR0EsTUErRUEsRUEvRVcsTUFDVCxNQUFNQSxFQUFlQyxTQUFTQyxjQUFjLE9BQ3RDQyxFQUFlRixTQUFTQyxjQUFjLE9BQ3RDRSxFQUFtQkgsU0FBU0MsY0FBYyxXQUNoRCxJQUFJRyxFQUFPLE9BRVgsTUFBTUMsRUFBZ0JDLElBQ3BCLE1BQU1DLEVBQWNELEVBQWFFLE1BQU0sS0FDdkMsTUFBTyxDQUFDQyxHQUFJRixFQUFZLEdBQUlHLEdBQUlILEVBQVksS0F1RHhDSSxFQUFPLEtBQ1hULEVBQWFVLFVBQVVDLElBQUksV0FLN0IsT0FGQUYsSUFFTyxDQUNMQSxLQUFBQSxFQUNBRyxnQkFuQnNCLENBQUNDLEVBQVFDLEVBQVlDLEtBQzNDLElBQUlDLEVBQW9CLE9BQVhILEVBQWtCaEIsRUFBZUcsRUFDL0IsV0FBWGEsR0FDRkcsRUFBU2YsRUFDVEMsRUFBTyxTQUNGQSxFQUFPLE9BQ2RjLEVBQU9DLFlBQWMsR0FDckJELEVBQU9OLFVBQVVDLElBQUlHLEdBQ3JCQyxFQUFNRyxTQUFRQyxHQUFRSCxFQUFPSSxZQWpEWixDQUFDRCxJQUNoQixNQUFNRSxFQUFRdkIsU0FBU3dCLGNBQWMsT0FLckMsT0FKQUQsRUFBTVgsVUFBVUMsSUFBSSxRQUNwQlUsRUFBTUUsYUFBYSxjQUFlLEdBQUdKLEVBQUtLLE9BQU9qQixLQUFLWSxFQUFLSyxPQUFPaEIsS0FDOURXLEVBQUtNLFNBQVNKLEVBQU1YLFVBQVVDLElBQUksUUFLbEIsQ0FBQ1UsSUFDVixVQUFUbkIsSUFDRm1CLEVBQU1LLGlCQUFpQixTQUFTLEtBQzlCLFlBQXFCdkIsRUFBYWtCLEVBQU1NLGFBQWEsb0JBR3ZETixFQUFNSyxpQkFBaUIsYUFBYSxLQUNsQyxXQUFvQnZCLEVBQWFrQixFQUFNTSxhQUFhLHFCQUd4RE4sRUFBTUssaUJBQWlCLFNBQVMsS0FDOUIsV0FBd0J2QixFQUFha0IsRUFBTU0sYUFBYSxxQkFmeERDLENBQWdCUCxHQUNUQSxHQTJDZ0NRLENBQVdWLE9BWXBEVyxRQXJDZU4sSUFDZixNQUFNTyxFQUFnQixHQUFHUCxFQUFPakIsS0FBS2lCLEVBQU9oQixJQUM5QlYsU0FBU0MsY0FBYywyQkFBMkJnQyxPQUMxRHJCLFVBQVVDLElBQUksUUFtQ3BCcUIsU0EzQmdCM0IsSUFDaEJBLEVBQVlhLFNBQVFNLElBQ2xCMUIsU0FBU0MsY0FBYywyQkFBMkJ5QixFQUFPakIsS0FBS2lCLEVBQU9oQixPQUFPRSxVQUFVQyxJQUFJLFlBMEI1RnNCLGtCQWpDd0IsS0FDeEJwQyxFQUFhYSxVQUFVd0IsT0FBTyxVQUM5QmxDLEVBQWFVLFVBQVV3QixPQUFPLGFBM0N2QixHQzZFWCxFQTlFbUJDLElBRWpCLE1BQU1DLEVBQVEsR0FrQlJyQixFQVJZLENBQUNvQixJQUNqQixNQUFNRSxFQUFNLEdBQ1osSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlILEVBQU9BLEVBQU1HLElBQy9CRCxFQUFJRSxLQVZDLENBQ0xmLE9BQVEsQ0FBQ2pCLEVBU0srQixFQUFJSCxFQVROM0IsRUFTWWdDLEtBQUtDLE1BQU1ILEVBQUlILElBUnZDVixRQUFTLEdBQ1RpQixRQUFRLElBU1YsT0FBT0wsR0FHS00sQ0FBVVIsR0FDbEJTLEVBQU1wQixHQUFXVCxFQUFNUyxFQUFPakIsRUFBSWlCLEVBQU9oQixFQUFJMkIsR0E4Q25ELE1BQU8sQ0FDTFMsR0FBQUEsRUFDQUMsY0E5Q3FCckIsSUFDYm9CLEVBQUdwQixHQUFRa0IsT0E4Q25CSSxVQTNDaUJ0QixHQUNhLEtBQXZCb0IsRUFBR3BCLEdBQVFDLFFBMkNsQnNCLGNBeENxQnZCLElBQ3JCLE1BQU1MLEVBQU95QixFQUFHcEIsR0FHaEIsR0FGQUwsRUFBS3VCLFFBQVMsRUFDZCxVQUFXbEIsR0FDUEwsRUFBS00sUUFBUyxDQUNoQixNQUFNdUIsRUFBT1osRUFBTWEsTUFBS0QsR0FBUUEsRUFBS0UsT0FBUy9CLEVBQUtNLFVBQ25EdUIsRUFBS0csTUFDREgsRUFBS0ksVUFhSSxDQUFDQyxJQUNoQkMsUUFBUUMsSUFBSUYsR0FDWixNQUFNaEQsRUFBY1UsRUFBTXlDLFFBQU9yQyxHQUFRQSxFQUFLTSxVQUFZNEIsSUFBVUksS0FBSXRDLEdBQVFBLEVBQUtLLFNBQ3JGLFdBQVluQixJQWhCUzJCLENBQVNnQixFQUFLRSxRQWtDbkNRLFFBOUJjLENBQUNWLEVBQU14QixFQUFRbUMsRUFBTyxPQUNwQ3ZCLEVBQU1HLEtBQUtTLEdBQ1gsSUFBSVksRUFBWXBDLEVBQ2hCLElBQUssSUFBSWMsRUFBSSxFQUFHQSxFQUFJVSxFQUFLYSxZQUFhdkIsSUFDcENNLEVBQUdnQixHQUFXbkMsUUFBVXVCLEVBQUtFLEtBQ3BCLE1BQVRTLEVBQWVDLEVBQVVyRCxJQUFLcUQsRUFBVXBELEtBMEIxQ3NELGFBaEJvQkMsSUFDcEIsSUFBSyxNQUFNQyxLQUFjRCxFQUFpQixDQUN4QyxHQUFJQyxFQUFXekQsRUFBSTRCLEVBQU8sR0FBSzZCLEVBQVd4RCxFQUFJMkIsRUFBTyxFQUFHLE9BQU8sRUFDL0QsR0FBK0IsS0FBM0JTLEVBQUdvQixHQUFZdkMsUUFBZ0IsT0FBTyxFQUU1QyxPQUFPLEdBWVB3QyxTQVRlLElBQU1sRCxJQ3pEekIsRUFSZ0JtQyxJQUNQLENBQ0xBLEtBQUFBLEVBQ0FnQixVQUFXLEVBQVUsSUFDckJDLFVBQVUsSUNtQmQsRUF6QmEsQ0FBQ0MsRUFBUWxCLEtBQ3BCLE1BQU1tQixFQUFhRCxFQUNuQixJQUFJRSxFQUFXLEVBY2YsTUFBTyxDQUNMcEIsS0FBQUEsRUFDQVcsVUFiZ0IsSUFBTVEsRUFjdEJFLFFBYmMsSUFBTUQsRUFjcEJuQixJQVpVLEtBQ1ZtQixLQVlBbEIsT0FUYSxJQUNOaUIsSUFBZUMsSUNDMUIsRUFacUJ2RCxJQUNqQixNQUFNeUQsRUFBYXpELEVBQU15QyxRQUFPckMsSUFBU0EsRUFBS3VCLFNBRTlDLE9BRGU4QixFQUFXaEMsS0FBS0MsTUFBTUQsS0FBS2lDLFNBQVdELEVBQVdKLFNBQVM1QyxRQzhEN0UsRUE1RHVCLE1BRXJCLE1BQU1rRCxFQUFVLEVBQU8sVUFDakJDLEVBQVUsRUFBTyxTQU1qQkMsRUFBVyxJQUNSRixFQUFRUCxTQUFXUSxFQUFTRCxFQXVCL0JHLEVBQVlyRCxJQUNoQixNQUFNc0QsRUFBZ0JGLElBQVdWLFVBQzVCWSxFQUFjakMsY0FBY3JCLEtBQ2pDc0QsRUFBYy9CLGNBQWN2QixHQUN2QnNELEVBQWNoQyxVQUFVdEIsS0F2QjdCa0QsRUFBUVAsVUFBWU8sRUFBUVAsU0FDNUJRLEVBQVFSLFVBQVlRLEVBQVFSLFNBQzVCLHVCQXNCQVksTUFHSUEsRUFBV0MsVUFDWEwsRUFBUVIsaUJBQ0UsSUFyQ1AsSUFBSWMsU0FBUUMsR0FBV0MsV0FBV0QsRUFxQzNCLFFBQ1pMLEVBQVMsRUFBYUQsSUFBV1YsVUFBVUQsZUFTL0MsTUFBTyxDQUNMeEQsS0FOVyxLQTVCWGlFLEVBQVFQLFVBQVcsRUFDbkJPLEVBQVFSLFVBQVksb0JBQTZCQSxVQUNqRCxrQkFBbUIsS0FBTVEsRUFBUXhCLEtBQU13QixFQUFRUixVQUFVRCxZQUd2QyxNQUNsQlUsRUFBUVIsVUFBVyxFQUNuQixJQUFJL0IsRUFBUSxDQUFDLEVBQUssRUFBRyxVQUFXLEVBQUssRUFBRyxXQUN4Q3VDLEVBQVFULFVBQVVSLFFBQVF0QixFQUFNLEdBQUksQ0FBQzdCLEVBQUcsRUFBR0MsRUFBRyxHQUFJLEtBQ2xEbUUsRUFBUVQsVUFBVVIsUUFBUXRCLEVBQU0sR0FBSSxDQUFDN0IsRUFBRyxFQUFHQyxFQUFHLEdBQUksS0FDbEQsa0JBQW1CLEtBQU1tRSxFQUFRekIsS0FBTXlCLEVBQVFULFVBQVVELGFBb0J6RG1CLElBS0FQLFNBQUFBLElBdkRtQixHQ3NGdkIsRUF2Rm1CLE1BQ2pCLE1BQU1oRSxFQUFTLEVBQU8sVUFDaEJ1QixFQUFRLENBQUMsRUFBSyxFQUFHLE1BQU8sRUFBSyxFQUFHLEtBQU0sRUFBSyxFQUFHLEtBQU0sRUFBSyxFQUFHLEtBQU0sRUFBSyxFQUFHLE1BQ2hGLElBQUlpRCxFQUFVLENBQ1pDLFFBQVMsRUFDVHZCLGdCQUFpQixHQUNqQkosS0FBTSxLQUVSLE1BQU00QixFQUFTekYsU0FBU0MsY0FBYyxVQU1oQ3lGLEVBQVVoRSxHQUNQMUIsU0FBU0MsY0FBYyxpQkFBaUJ5QixFQUFPakIsS0FBS2lCLEVBQU9oQixPQUs5RGlGLEVBQVlqRSxJQUN1QixJQUFuQzZELEVBQVF0QixnQkFBZ0JLLFFBQzFCaUIsRUFBUXRCLGdCQUFnQjdDLFNBQVFNLElBQzlCZ0UsRUFBT2hFLEdBQVFkLFVBQVVnRixPQUFPLFFBQ2hDRixFQUFPaEUsR0FBUWQsVUFBVWdGLE9BQU8sY0FHcENMLEVBQVF0QixnQkFBa0I0QixFQUFTbkUsR0FDbkM2RCxFQUFRdEIsZ0JBQWdCN0MsU0FBUU0sSUFDOUJnRSxFQUFPaEUsR0FBUWQsVUFBVUMsSUFBSSxXQUUxQmlGLEtBQ0hQLEVBQVF0QixnQkFBZ0I3QyxTQUFRTSxJQUM5QmdFLEVBQU9oRSxHQUFRZCxVQUFVQyxJQUFJLGVBSzdCZ0YsRUFBWW5FLElBQ2hCLElBQUl1QyxFQUFrQixHQUNsQkgsRUFBWXBDLEVBQ2hCLElBQUssSUFBSWMsRUFBSSxFQUFHQSxFQUFJRixFQUFNaUQsRUFBUUMsU0FBU3pCLGNBQ3pDRSxFQUFnQnhCLEtBQUssQ0FBQ2hDLEVBQUdxRCxFQUFVckQsRUFBR0MsRUFBR29ELEVBQVVwRCxJQUNsQyxNQUFqQjZFLEVBQVExQixLQUFlQyxFQUFVckQsSUFBS3FELEVBQVVwRCxNQUM1Q29ELEVBQVVyRCxFQUFJLEdBQUtxRCxFQUFVcEQsRUFBSSxJQUhpQjhCLEtBS3hELE9BQU95QixHQUdINkIsRUFBYyxLQUNUL0UsRUFBT3FELFVBQVVKLGFBQWF1QixFQUFRdEIsa0JBQ3pDc0IsRUFBUXRCLGdCQUFnQkssU0FBV2hDLEVBQU1pRCxFQUFRQyxTQUFTekIsWUEyQmxFLE1BQU8sQ0FDTHBELEtBWFcsS0FDWCxrQkFBbUIsU0FBVUksRUFBT3FDLEtBQU1yQyxFQUFPcUQsVUFBVUQsWUFDM0RuRSxTQUFTNEIsaUJBQWlCLFNBQVMsRUFBR21FLElBQUFBLE1BQ3hCLE1BQVJBLEdBQXVCLE1BQVJBLElBQ2pCUixFQUFRMUIsS0FBd0IsTUFBakIwQixFQUFRMUIsS0FBZSxJQUFLLElBQzNDOEIsRUFBU0osRUFBUXRCLGdCQUFnQixHQUFJc0IsRUFBUTFCLFdBT2pEbUMsVUF6QmlCdEUsSUFDWm9FLE1BQ0wvRSxFQUFPcUQsVUFBVVIsUUFBUXRCLEVBQU1pRCxFQUFRQyxXQUFZOUQsRUFBUTZELEVBQVExQixNQUNuRTBCLEVBQVF0QixnQkFBZ0I3QyxTQUFRTSxHQUFVZ0UsRUFBT2hFLEdBQVFkLFVBQVVDLElBQUksVUFDdkUsa0JBQW1CLFNBQVVFLEVBQU9xQyxLQUFNckMsRUFBT3FELFVBQVVELFlBQ3ZEb0IsRUFBUUMsVUFBWWxELEVBQU1nQyxTQUM1Qm1CLEVBQU9HLFNBQ1AsWUFtQkZELFNBQUFBLEVBQ0FNLGdCQWhCc0IsSUFBTWxGLElBbEViLEdDRm5CLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvVUkuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3JpZXMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yaWVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3Rvcmllcy9TaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9BSVBsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvR2FtZUNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL1BsYWNlU2hpcHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSBcIi4vR2FtZUNvbnRyb2xsZXJcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL1BsYWNlU2hpcHNcIjtcblxuY29uc3QgVUkgPSAoKCkgPT4ge1xuICBjb25zdCAkcDFHYW1lYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuUDEnKTtcbiAgY29uc3QgJHAyR2FtZWJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLlAyJyk7XG4gIGNvbnN0ICRzYW1wbGVHYW1lQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2FtcGxlJyk7XG4gIGxldCBtb2RlID0gJ1BMQVknO1xuXG4gIGNvbnN0IGRlY29kZUNvb3JkcyA9IChjb29yZHNTdHJpbmcpID0+IHtcbiAgICBjb25zdCBjb29yZHNBcnJheSA9IGNvb3Jkc1N0cmluZy5zcGxpdCgnICcpO1xuICAgIHJldHVybiB7eDogK2Nvb3Jkc0FycmF5WzBdLCB5OiArY29vcmRzQXJyYXlbMV19O1xuICB9XG4gIFxuICBjb25zdCBuZXdDZWxsRE9NID0gKGNlbGwpID0+IHtcbiAgICAgIGNvbnN0ICRjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAkY2VsbC5jbGFzc0xpc3QuYWRkKCdjZWxsJyk7XG4gICAgICAkY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJywgYCR7Y2VsbC5jb29yZHMueH0gJHtjZWxsLmNvb3Jkcy55fWApO1xuICAgICAgaWYgKGNlbGwuaGFzU2hpcCkgJGNlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcCcpO1xuICAgICAgYWRkQ2VsbExpc3RlbmVyKCRjZWxsKTtcbiAgICAgIHJldHVybiAkY2VsbDtcbiAgfVxuXG4gIGNvbnN0IGFkZENlbGxMaXN0ZW5lciA9ICgkY2VsbCkgPT4ge1xuICAgIGlmIChtb2RlID09PSAnUExBQ0UnKSB7XG4gICAgICAkY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgUGxhY2VTaGlwcy5wbGFjZVNoaXAoZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSkpO1xuICAgICAgfSk7XG4gIFxuICAgICAgJGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgICBQbGFjZVNoaXBzLnNob3dTaGlwKGRlY29kZUNvb3JkcygkY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJykpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIEdhbWVDb250cm9sbGVyLnBsYXlUdXJuKGRlY29kZUNvb3JkcygkY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJykpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGNlbGxIaXQgPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3QgZW5jb2RlZENvb3JkcyA9IGAke2Nvb3Jkcy54fSAke2Nvb3Jkcy55fWA7XG4gICAgY29uc3QgJGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuYWN0aXZlID4gW2RhdGEtY29vcmRzPVwiJHtlbmNvZGVkQ29vcmRzfVwiXWApO1xuICAgICRjZWxsLmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICB9XG5cbiAgY29uc3QgdG9nZ2xlQWN0aXZlQm9hcmQgPSAoKSA9PiB7XG4gICAgJHAxR2FtZWJvYXJkLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgICRwMkdhbWVib2FyZC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgfVxuXG4gIGNvbnN0IHNoaXBTdW5rID0gKGNvb3Jkc0FycmF5KSA9PiB7XG4gICAgY29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmFjdGl2ZSA+IFtkYXRhLWNvb3Jkcz1cIiR7Y29vcmRzLnh9ICR7Y29vcmRzLnl9XCJdYCkuY2xhc3NMaXN0LmFkZCgnc3VuaycpO1xuICAgIH0pXG4gIH1cblxuICBjb25zdCByZW5kZXJHYW1lYm9hcmQgPSAocGxheWVyLCBwbGF5ZXJOYW1lLCBib2FyZCkgPT4ge1xuICAgIGxldCAkYm9hcmQgPSBwbGF5ZXIgPT09ICdQMScgPyAkcDFHYW1lYm9hcmQgOiAkcDJHYW1lYm9hcmQ7XG4gICAgaWYgKHBsYXllciA9PT0gJ3NhbXBsZScpIHtcbiAgICAgICRib2FyZCA9ICRzYW1wbGVHYW1lQm9hcmQ7XG4gICAgICBtb2RlID0gJ1BMQUNFJztcbiAgICB9IGVsc2UgbW9kZSA9ICdQTEFZJztcbiAgICAkYm9hcmQudGV4dENvbnRlbnQgPSAnJztcbiAgICAkYm9hcmQuY2xhc3NMaXN0LmFkZChwbGF5ZXJOYW1lKTtcbiAgICBib2FyZC5mb3JFYWNoKGNlbGwgPT4gJGJvYXJkLmFwcGVuZENoaWxkKG5ld0NlbGxET00oY2VsbCkpKTtcbiAgfVxuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgJHAyR2FtZWJvYXJkLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICB9XG5cbiAgaW5pdCgpO1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgICByZW5kZXJHYW1lYm9hcmQsXG4gICAgY2VsbEhpdCxcbiAgICBzaGlwU3VuayxcbiAgICB0b2dnbGVBY3RpdmVCb2FyZCxcbiAgfTtcblxufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgVUk7IiwiaW1wb3J0IFVJIGZyb20gXCIuLi9Nb2R1bGVzL1VJXCI7XG5cbmNvbnN0IEdhbWVib2FyZCA9IChzaXplKSA9PiB7XG5cbiAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICBjb25zdCBjZWxsID0gKHgsIHkpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgY29vcmRzOiB7eCwgeX0sXG4gICAgICBoYXNTaGlwOiAnJyxcbiAgICAgIGlzU2hvdDogZmFsc2VcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgX21ha2VHcmlkID0gKHNpemUpID0+IHtcbiAgICBjb25zdCBhcnIgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemUgKiBzaXplOyBpKyspIHtcbiAgICAgIGFyci5wdXNoKGNlbGwoaSAlIHNpemUsIE1hdGguZmxvb3IoaSAvIHNpemUpKSk7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH1cblxuICBjb25zdCBib2FyZCA9IF9tYWtlR3JpZChzaXplKTtcbiAgY29uc3QgYXQgPSAoY29vcmRzKSA9PiBib2FyZFtjb29yZHMueCArIGNvb3Jkcy55ICogc2l6ZV07XG5cbiAgY29uc3QgaXNWYWxpZEF0dGFjayA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gIWF0KGNvb3JkcykuaXNTaG90O1xuICB9XG5cbiAgY29uc3QgaXNTaGlwSGl0ID0gKGNvb3JkcykgPT4ge1xuICAgIHJldHVybiBhdChjb29yZHMpLmhhc1NoaXAgIT09ICcnO1xuICB9XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZHMpID0+IHtcbiAgICBjb25zdCBjZWxsID0gYXQoY29vcmRzKTtcbiAgICBjZWxsLmlzU2hvdCA9IHRydWU7XG4gICAgVUkuY2VsbEhpdChjb29yZHMpO1xuICAgIGlmIChjZWxsLmhhc1NoaXApIHtcbiAgICAgIGNvbnN0IHNoaXAgPSBzaGlwcy5maW5kKHNoaXAgPT4gc2hpcC5uYW1lID09PSBjZWxsLmhhc1NoaXApO1xuICAgICAgc2hpcC5oaXQoKTtcbiAgICAgIGlmIChzaGlwLmlzU3VuaygpKSBzaGlwU3VuayhzaGlwLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHNldFNoaXAgPSAoc2hpcCwgY29vcmRzLCBheGlzID0gJ3gnKSA9PiB7XG4gICAgc2hpcHMucHVzaChzaGlwKTtcbiAgICBsZXQgbmV3Q29vcmRzID0gY29vcmRzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcC5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICBhdChuZXdDb29yZHMpLmhhc1NoaXAgPSBzaGlwLm5hbWU7XG4gICAgICBheGlzID09PSAneCcgPyBuZXdDb29yZHMueCsrOiBuZXdDb29yZHMueSsrO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHNoaXBTdW5rID0gKHNoaXBOYW1lKSA9PiB7XG4gICAgY29uc29sZS5sb2coc2hpcE5hbWUpO1xuICAgIGNvbnN0IGNvb3Jkc0FycmF5ID0gYm9hcmQuZmlsdGVyKGNlbGwgPT4gY2VsbC5oYXNTaGlwID09PSBzaGlwTmFtZSkubWFwKGNlbGwgPT4gY2VsbC5jb29yZHMpO1xuICAgIFVJLnNoaXBTdW5rKGNvb3Jkc0FycmF5KTtcbiAgfVxuXG4gIGNvbnN0IGlzQ29sbGlzaW9ucyA9IChzaGlwQ29vcmRzQXJyYXkpID0+IHtcbiAgICBmb3IgKGNvbnN0IHNoaXBDb29yZHMgb2Ygc2hpcENvb3Jkc0FycmF5KSB7XG4gICAgICBpZiAoc2hpcENvb3Jkcy54ID4gc2l6ZSAtIDEgfHwgc2hpcENvb3Jkcy55ID4gc2l6ZSAtIDEpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGF0KHNoaXBDb29yZHMpLmhhc1NoaXAgIT09ICcnKSByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZDtcblxuICByZXR1cm4ge1xuICAgIGF0LFxuICAgIGlzVmFsaWRBdHRhY2ssXG4gICAgaXNTaGlwSGl0LFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgc2V0U2hpcCxcbiAgICBpc0NvbGxpc2lvbnMsXG4gICAgZ2V0Qm9hcmQsXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDsiLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiXG5cbmNvbnN0IFBsYXllciA9IChuYW1lKSA9PiB7XG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBnYW1lYm9hcmQ6IEdhbWVib2FyZCgxMCksXG4gICAgaXNBY3RpdmU6IGZhbHNlLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7IiwiY29uc3QgU2hpcCA9IChsZW5ndGgsIG5hbWUpID0+IHtcbiAgY29uc3Qgc2hpcExlbmd0aCA9IGxlbmd0aDtcbiAgbGV0IGhpdENvdW50ID0gMDtcblxuICAvLyBHZXR0ZXJzXG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHNoaXBMZW5ndGg7XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiBoaXRDb3VudDtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0Q291bnQrKztcbiAgfVxuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcExlbmd0aCA9PT0gaGl0Q291bnQ7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZ2V0TGVuZ3RoLFxuICAgIGdldEhpdHMsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hpcDsiLCJjb25zdCBBSSA9ICgoKSA9PiB7XG5cbiAgY29uc3QgZ2V0Q29vcmRzID0gKGJvYXJkKSA9PiB7XG4gICAgY29uc3QgdmFsaWRDZWxscyA9IGJvYXJkLmZpbHRlcihjZWxsID0+ICFjZWxsLmlzU2hvdCk7XG4gICAgY29uc3QgY29vcmRzID0gdmFsaWRDZWxsc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENlbGxzLmxlbmd0aCldLmNvb3JkcztcbiAgICByZXR1cm4gY29vcmRzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0Q29vcmRzLFxuICB9O1xuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBBSTsiLCJpbXBvcnQgUGxheWVyIGZyb20gXCIuLi9GYWN0b3JpZXMvUGxheWVyXCJcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9GYWN0b3JpZXMvU2hpcFwiO1xuaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgQUkgZnJvbSBcIi4vQUlQbGF5ZXJcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL1BsYWNlU2hpcHNcIjtcblxuY29uc3QgR2FtZUNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuXG4gIGNvbnN0IHBsYXllcjEgPSBQbGF5ZXIoJ3BsYXllcicpO1xuICBjb25zdCBwbGF5ZXIyID0gUGxheWVyKCdlbmVteScpO1xuXG4gIGZ1bmN0aW9uIHNsZWVwKG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9IFxuXG4gIGNvbnN0IG9wcG9uZW50ID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXIxLmlzQWN0aXZlID8gcGxheWVyMjogcGxheWVyMTtcbiAgfVxuXG4gIGNvbnN0IHRvZ2dsZUFjdGl2ZVBsYXllciA9ICgpID0+IHtcbiAgICBwbGF5ZXIxLmlzQWN0aXZlID0gIXBsYXllcjEuaXNBY3RpdmU7XG4gICAgcGxheWVyMi5pc0FjdGl2ZSA9ICFwbGF5ZXIyLmlzQWN0aXZlO1xuICAgIFVJLnRvZ2dsZUFjdGl2ZUJvYXJkKCk7XG4gIH1cblxuICBjb25zdCBpbml0UGxheWVyMSA9ICgpID0+IHtcbiAgICBwbGF5ZXIxLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICBwbGF5ZXIxLmdhbWVib2FyZCA9IFBsYWNlU2hpcHMuZ2V0U2FtcGxlUGxheWVyKCkuZ2FtZWJvYXJkO1xuICAgIFVJLnJlbmRlckdhbWVib2FyZCgnUDEnLCBwbGF5ZXIxLm5hbWUsIHBsYXllcjEuZ2FtZWJvYXJkLmdldEJvYXJkKCkpO1xuICB9XG5cbiAgY29uc3QgaW5pdFBsYXllcjIgPSAoKSA9PiB7XG4gICAgcGxheWVyMi5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIGxldCBzaGlwcyA9IFtTaGlwKDMsICdlbmVteWEnKSwgU2hpcCgyLCAnZW5lbXliJyldO1xuICAgIHBsYXllcjIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbMF0sIHt4OiAxLCB5OiAxfSwgJ3gnKTtcbiAgICBwbGF5ZXIyLmdhbWVib2FyZC5zZXRTaGlwKHNoaXBzWzFdLCB7eDogMiwgeTogNX0sICd5Jyk7XG4gICAgVUkucmVuZGVyR2FtZWJvYXJkKCdQMicsIHBsYXllcjIubmFtZSwgcGxheWVyMi5nYW1lYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH1cblxuICBjb25zdCBwbGF5VHVybiA9IChjb29yZHMpID0+IHtcbiAgICBjb25zdCBvcHBvbmVudEJvYXJkID0gb3Bwb25lbnQoKS5nYW1lYm9hcmQ7XG4gICAgaWYgKCFvcHBvbmVudEJvYXJkLmlzVmFsaWRBdHRhY2soY29vcmRzKSkgcmV0dXJuO1xuICAgIG9wcG9uZW50Qm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZHMpO1xuICAgIGlmICghb3Bwb25lbnRCb2FyZC5pc1NoaXBIaXQoY29vcmRzKSkgdG9nZ2xlQWN0aXZlUGxheWVyKCk7XG4gICAgcGxheUdhbWUoKTtcbiAgfVxuXG4gIGNvbnN0IHBsYXlHYW1lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmIChwbGF5ZXIyLmlzQWN0aXZlKSB7XG4gICAgICBhd2FpdCBzbGVlcCgzMDApO1xuICAgICAgcGxheVR1cm4oQUkuZ2V0Q29vcmRzKG9wcG9uZW50KCkuZ2FtZWJvYXJkLmdldEJvYXJkKCkpKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIGluaXRQbGF5ZXIxKCk7XG4gICAgaW5pdFBsYXllcjIoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgcGxheVR1cm4sXG4gIH07XG5cbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVDb250cm9sbGVyOyIsImltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9HYW1lQ29udHJvbGxlclwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi4vRmFjdG9yaWVzL1BsYXllclwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4uL0ZhY3Rvcmllcy9TaGlwXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcblxuY29uc3QgUGxhY2VTaGlwcyA9ICgoKSA9PiB7XG4gIGNvbnN0IHBsYXllciA9IFBsYXllcignc2FtcGxlJyk7XG4gIGNvbnN0IHNoaXBzID0gW1NoaXAoNCwgJ2FrJyksIFNoaXAoMiwgJ2InKSwgU2hpcCg1LCAnYycpLCBTaGlwKDQsICdkJyksIFNoaXAoMiwgJ2UnKV07XG4gIGxldCBjdXJyZW50ID0ge1xuICAgIHNoaXBOdW06IDAsXG4gICAgc2hpcENvb3Jkc0FycmF5OiBbXSxcbiAgICBheGlzOiAneCdcbiAgfTtcbiAgY29uc3QgJG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJylcblxuICAvLyBVdGlsIFxuXG4gIFxuXG4gIGNvbnN0IGNlbGxBdCA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtY29vcmRzPVwiJHtjb29yZHMueH0gJHtjb29yZHMueX1cIl1gKTtcbiAgfVxuXG4gIC8vIERPTVxuXG4gIGNvbnN0IHNob3dTaGlwID0gKGNvb3JkcykgPT4ge1xuICAgIGlmIChjdXJyZW50LnNoaXBDb29yZHNBcnJheS5sZW5ndGggIT09IDApIHtcbiAgICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IHtcbiAgICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LnJlbW92ZSgndGVtcCcpO1xuICAgICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QucmVtb3ZlKCdpbnZhbGlkJyk7XG4gICAgICB9KVxuICAgIH1cbiAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheSA9IG1ha2VTaGlwKGNvb3Jkcyk7XG4gICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LmFkZChcInRlbXBcIik7XG4gICAgfSlcbiAgICBpZiAoIWlzU2hpcFZhbGlkKCkpIHtcbiAgICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IHtcbiAgICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LmFkZChcImludmFsaWRcIik7XG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG1ha2VTaGlwID0gKGNvb3JkcykgPT4ge1xuICAgIGxldCBzaGlwQ29vcmRzQXJyYXkgPSBbXTtcbiAgICBsZXQgbmV3Q29vcmRzID0gY29vcmRzO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcHNbY3VycmVudC5zaGlwTnVtXS5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICBzaGlwQ29vcmRzQXJyYXkucHVzaCh7eDogbmV3Q29vcmRzLngsIHk6IG5ld0Nvb3Jkcy55fSk7XG4gICAgICBjdXJyZW50LmF4aXMgPT09ICd4JyA/IG5ld0Nvb3Jkcy54Kys6IG5ld0Nvb3Jkcy55Kys7XG4gICAgICBpZiAobmV3Q29vcmRzLnggPiA5IHx8IG5ld0Nvb3Jkcy55ID4gOSkgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBzaGlwQ29vcmRzQXJyYXk7XG4gIH1cblxuICBjb25zdCBpc1NoaXBWYWxpZCA9ICgpID0+IHtcbiAgICByZXR1cm4gKCFwbGF5ZXIuZ2FtZWJvYXJkLmlzQ29sbGlzaW9ucyhjdXJyZW50LnNoaXBDb29yZHNBcnJheSkgJiYgXG4gICAgICAgICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkubGVuZ3RoID09PSBzaGlwc1tjdXJyZW50LnNoaXBOdW1dLmdldExlbmd0aCgpKTtcbiAgfVxuXG4gIFxuICBjb25zdCBwbGFjZVNoaXAgPSAoY29vcmRzKSA9PiB7XG4gICAgaWYgKCFpc1NoaXBWYWxpZCgpKSByZXR1cm47XG4gICAgcGxheWVyLmdhbWVib2FyZC5zZXRTaGlwKHNoaXBzW2N1cnJlbnQuc2hpcE51bSsrXSwgY29vcmRzLCBjdXJyZW50LmF4aXMpO1xuICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5hZGQoJ3NoaXAnKSk7XG4gICAgVUkucmVuZGVyR2FtZWJvYXJkKCdzYW1wbGUnLCBwbGF5ZXIubmFtZSwgcGxheWVyLmdhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgICBpZiAoY3VycmVudC5zaGlwTnVtID09PSBzaGlwcy5sZW5ndGgpIHtcbiAgICAgICRtb2RhbC5yZW1vdmUoKTtcbiAgICAgIEdhbWVDb250cm9sbGVyLmluaXQoKTtcbiAgICB9XG4gIH1cbiAgXG4gIGNvbnN0IGdldFNhbXBsZVBsYXllciA9ICgpID0+IHBsYXllcjtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIFVJLnJlbmRlckdhbWVib2FyZCgnc2FtcGxlJywgcGxheWVyLm5hbWUsIHBsYXllci5nYW1lYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoeyBrZXkgfSkgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gJ1InIHx8IGtleSA9PT0gJ3InKSB7XG4gICAgICAgIGN1cnJlbnQuYXhpcyA9IGN1cnJlbnQuYXhpcyA9PT0gJ3gnID8gJ3knOiAneCc7XG4gICAgICAgIHNob3dTaGlwKGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5WzBdLCBjdXJyZW50LmF4aXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0LFxuICAgIHBsYWNlU2hpcCxcbiAgICBzaG93U2hpcCxcbiAgICBnZXRTYW1wbGVQbGF5ZXIsXG4gIH1cblxufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgUGxhY2VTaGlwczsiLCIvLyBpbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSBcIi4vTW9kdWxlcy9HYW1lQ29udHJvbGxlclwiO1xuaW1wb3J0IFBsYWNlU2hpcHMgZnJvbSBcIi4vTW9kdWxlcy9QbGFjZVNoaXBzXCI7XG5cblBsYWNlU2hpcHMuaW5pdCgpOyJdLCJuYW1lcyI6WyIkcDFHYW1lYm9hcmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCIkcDJHYW1lYm9hcmQiLCIkc2FtcGxlR2FtZUJvYXJkIiwibW9kZSIsImRlY29kZUNvb3JkcyIsImNvb3Jkc1N0cmluZyIsImNvb3Jkc0FycmF5Iiwic3BsaXQiLCJ4IiwieSIsImluaXQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW5kZXJHYW1lYm9hcmQiLCJwbGF5ZXIiLCJwbGF5ZXJOYW1lIiwiYm9hcmQiLCIkYm9hcmQiLCJ0ZXh0Q29udGVudCIsImZvckVhY2giLCJjZWxsIiwiYXBwZW5kQ2hpbGQiLCIkY2VsbCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjb29yZHMiLCJoYXNTaGlwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdldEF0dHJpYnV0ZSIsImFkZENlbGxMaXN0ZW5lciIsIm5ld0NlbGxET00iLCJjZWxsSGl0IiwiZW5jb2RlZENvb3JkcyIsInNoaXBTdW5rIiwidG9nZ2xlQWN0aXZlQm9hcmQiLCJ0b2dnbGUiLCJzaXplIiwic2hpcHMiLCJhcnIiLCJpIiwicHVzaCIsIk1hdGgiLCJmbG9vciIsImlzU2hvdCIsIl9tYWtlR3JpZCIsImF0IiwiaXNWYWxpZEF0dGFjayIsImlzU2hpcEhpdCIsInJlY2VpdmVBdHRhY2siLCJzaGlwIiwiZmluZCIsIm5hbWUiLCJoaXQiLCJpc1N1bmsiLCJzaGlwTmFtZSIsImNvbnNvbGUiLCJsb2ciLCJmaWx0ZXIiLCJtYXAiLCJzZXRTaGlwIiwiYXhpcyIsIm5ld0Nvb3JkcyIsImdldExlbmd0aCIsImlzQ29sbGlzaW9ucyIsInNoaXBDb29yZHNBcnJheSIsInNoaXBDb29yZHMiLCJnZXRCb2FyZCIsImdhbWVib2FyZCIsImlzQWN0aXZlIiwibGVuZ3RoIiwic2hpcExlbmd0aCIsImhpdENvdW50IiwiZ2V0SGl0cyIsInZhbGlkQ2VsbHMiLCJyYW5kb20iLCJwbGF5ZXIxIiwicGxheWVyMiIsIm9wcG9uZW50IiwicGxheVR1cm4iLCJvcHBvbmVudEJvYXJkIiwicGxheUdhbWUiLCJhc3luYyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImluaXRQbGF5ZXIyIiwiY3VycmVudCIsInNoaXBOdW0iLCIkbW9kYWwiLCJjZWxsQXQiLCJzaG93U2hpcCIsInJlbW92ZSIsIm1ha2VTaGlwIiwiaXNTaGlwVmFsaWQiLCJrZXkiLCJwbGFjZVNoaXAiLCJnZXRTYW1wbGVQbGF5ZXIiXSwic291cmNlUm9vdCI6IiJ9