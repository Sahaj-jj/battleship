(()=>{"use strict";const e=(()=>{const e=document.querySelector(".main"),t=document.querySelector(".modal");let s="PLAY";const a=e=>{const t=e.split(" ");return{x:+t[0],y:+t[1]}};return{renderGameboard:(i,d,n,c=!1)=>{s="sample"===d?"PLACE":"PLAY";const l=(a=>{const i=document.createElement("div");i.classList.add("container");const r=document.createElement("div");r.classList.add(`${a}`),r.classList.add("board");const o=document.createElement("div");return o.classList.add("ships-display"),i.appendChild(r),i.appendChild(o),"PLACE"===s?t.appendChild(i):e.appendChild(i),i})(d);c&&l.firstChild.classList.add("active"),n.forEach((e=>l.firstChild.appendChild((e=>{const t=document.createElement("div");return t.classList.add("cell"),t.setAttribute("data-coords",`${e.coords.x} ${e.coords.y}`),e.hasShip&&t.classList.add("ship"),(e=>{"PLACE"===s?(e.addEventListener("click",(()=>{o.placeShip(a(e.getAttribute("data-coords")))})),e.addEventListener("mouseover",(()=>{o.showShip(a(e.getAttribute("data-coords")))}))):e.addEventListener("click",(()=>{r.playTurn(a(e.getAttribute("data-coords")))}))})(t),t})(e))))},updateShipsDisplay:(e,t,a=-1)=>{const i=document.querySelector(`.${e}`).nextElementSibling;i.textContent="",t.forEach(((e,t)=>{i.appendChild(((e,t=!1)=>{const a=document.createElement("div");return a.textContent=e.name,(e.isSunk()||"PLACE"===s&&t)&&a.classList.add("sunk"),a})(e,t<=a))}))},cellHit:e=>{const t=`${e.x} ${e.y}`;document.querySelector(`.active > [data-coords="${t}"]`).classList.add("hit")},shipSunk:e=>{e.forEach((e=>{document.querySelector(`.active > [data-coords="${e.x} ${e.y}"]`).classList.add("sunk")}))},toggleActiveBoard:()=>{Array.from(e.children).forEach((e=>{e.firstChild.classList.toggle("active")}))}}})(),t=t=>{const s=[],a=(e=>{const t=[];for(let s=0;s<e*e;s++)t.push({coords:{x:s%e,y:Math.floor(s/e)},hasShip:"",isShot:!1});return t})(t),i=e=>a[e.x+e.y*t];return{at:i,isValidAttack:e=>!i(e).isShot,isShipHit:e=>""!==i(e).hasShip,receiveAttack:t=>{const r=i(t);if(r.isShot=!0,e.cellHit(t),r.hasShip){const t=s.find((e=>e.name===r.hasShip));t.hit(),t.isSunk()&&(t=>{console.log(t);const s=a.filter((e=>e.hasShip===t)).map((e=>e.coords));e.shipSunk(s)})(t.name)}},setShip:(e,t,a="x")=>{s.push(e);let r=t;for(let t=0;t<e.getLength();t++)i(r).hasShip=e.name,"x"===a?r.x++:r.y++},isCollisions:e=>{for(const s of e){if(s.x>t-1||s.y>t-1)return!0;if(""!==i(s).hasShip)return!0}return!1},getBoard:()=>a,getShips:()=>s}},s=e=>({name:e,gameboard:t(10),isActive:!1}),a=(e,t)=>{const s=e;let a=0;return{name:t,getLength:()=>s,getHits:()=>a,hit:()=>{a++},isSunk:()=>a>=s}},i=e=>{const t=e.filter((e=>!e.isShot));return t[Math.floor(Math.random()*t.length)].coords},r=(()=>{const t=s("P1"),r=s("P2"),d=()=>t.isActive?r:t,n=s=>{const a=d().gameboard;a.isValidAttack(s)&&(a.receiveAttack(s),e.updateShipsDisplay(d().name,a.getShips()),a.isShipHit(s)||(t.isActive=!t.isActive,r.isActive=!r.isActive,e.toggleActiveBoard()),c())},c=async()=>{r.isActive&&(await(300,new Promise((e=>setTimeout(e,300)))),n(i(d().gameboard.getBoard())))};return{init:()=>{t.isActive=!0,t.gameboard=o.getSamplePlayer().gameboard,e.renderGameboard("P1",t.name,t.gameboard.getBoard()),e.updateShipsDisplay(t.name,t.gameboard.getShips()),(()=>{r.isActive=!1;let t=[a(3,"enemya"),a(2,"enemyb")];r.gameboard.setShip(t[0],{x:1,y:1},"x"),r.gameboard.setShip(t[1],{x:2,y:5},"y"),e.renderGameboard("P2",r.name,r.gameboard.getBoard(),!0),e.updateShipsDisplay(r.name,r.gameboard.getShips())})()},playTurn:n}})(),o=(()=>{const t=s("sample"),i=[a(4,"ak"),a(2,"b"),a(5,"c"),a(4,"d"),a(2,"e")];let o={shipNum:0,shipCoordsArray:[],axis:"x"};const d=document.querySelector(".modal"),n=e=>document.querySelector(`[data-coords="${e.x} ${e.y}"]`),c=e=>{0!==o.shipCoordsArray.length&&o.shipCoordsArray.forEach((e=>{n(e).classList.remove("temp"),n(e).classList.remove("invalid")})),o.shipCoordsArray=l(e),o.shipCoordsArray.forEach((e=>{n(e).classList.add("temp")})),h()||o.shipCoordsArray.forEach((e=>{n(e).classList.add("invalid")}))},l=e=>{let t=[],s=e;for(let e=0;e<i[o.shipNum].getLength()&&(t.push({x:s.x,y:s.y}),"x"===o.axis?s.x++:s.y++,!(s.x>9||s.y>9));e++);return t},h=()=>!t.gameboard.isCollisions(o.shipCoordsArray)&&o.shipCoordsArray.length===i[o.shipNum].getLength();return{init:()=>{e.renderGameboard("sample",t.name,t.gameboard.getBoard()),e.updateShipsDisplay(t.name,i),document.addEventListener("keyup",(({key:e})=>{"R"!==e&&"r"!==e||(o.axis="x"===o.axis?"y":"x",c(o.shipCoordsArray[0],o.axis))}))},placeShip:s=>{h()&&(t.gameboard.setShip(i[o.shipNum++],s,o.axis),o.shipCoordsArray.forEach((e=>n(e).classList.add("ship"))),e.updateShipsDisplay(t.name,i,o.shipNum-1),o.shipNum===i.length&&(d.remove(),r.init()))},showShip:c,getSamplePlayer:()=>t}})();o.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBUXZCLGdCQUFnQnZELFNBQVFJLEdBQVUyRSxFQUFPM0UsR0FBUVgsVUFBVUMsSUFBSSxVQUN2RSxxQkFBc0JQLEVBQU9nQyxLQUFNUixFQUFPbUUsRUFBUWxFLFFBQVUsR0FDeERrRSxFQUFRbEUsVUFBWUQsRUFBTWlELFNBQzVCbEYsRUFBT3VHLFNBQ1AsWUFvQkZELFNBQUFBLEVBQ0FNLGdCQWpCc0IsSUFBTW5HLElBaEViLEdDRm5CLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvVUkuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3JpZXMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yaWVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3Rvcmllcy9TaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9BSVBsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvR2FtZUNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL1BsYWNlU2hpcHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSBcIi4vR2FtZUNvbnRyb2xsZXJcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL1BsYWNlU2hpcHNcIjtcblxuY29uc3QgVUkgPSAoKCkgPT4ge1xuICBjb25zdCAkbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYWluJyk7XG4gIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICBsZXQgbW9kZSA9ICdQTEFZJztcblxuICBjb25zdCBkZWNvZGVDb29yZHMgPSAoY29vcmRzU3RyaW5nKSA9PiB7XG4gICAgY29uc3QgY29vcmRzQXJyYXkgPSBjb29yZHNTdHJpbmcuc3BsaXQoJyAnKTtcbiAgICByZXR1cm4ge3g6ICtjb29yZHNBcnJheVswXSwgeTogK2Nvb3Jkc0FycmF5WzFdfTtcbiAgfVxuICBcbiAgY29uc3QgbmV3Q2VsbERPTSA9IChjZWxsKSA9PiB7XG4gICAgICBjb25zdCAkY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgJGNlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbCcpO1xuICAgICAgJGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLWNvb3JkcycsIGAke2NlbGwuY29vcmRzLnh9ICR7Y2VsbC5jb29yZHMueX1gKTtcbiAgICAgIGlmIChjZWxsLmhhc1NoaXApICRjZWxsLmNsYXNzTGlzdC5hZGQoJ3NoaXAnKTtcbiAgICAgIGFkZENlbGxMaXN0ZW5lcigkY2VsbCk7XG4gICAgICByZXR1cm4gJGNlbGw7XG4gIH1cblxuICBjb25zdCBhZGRDZWxsTGlzdGVuZXIgPSAoJGNlbGwpID0+IHtcbiAgICBpZiAobW9kZSA9PT0gJ1BMQUNFJykge1xuICAgICAgJGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIFBsYWNlU2hpcHMucGxhY2VTaGlwKGRlY29kZUNvb3JkcygkY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJykpKTtcbiAgICAgIH0pO1xuICBcbiAgICAgICRjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsICgpID0+IHtcbiAgICAgICAgUGxhY2VTaGlwcy5zaG93U2hpcChkZWNvZGVDb29yZHMoJGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLWNvb3JkcycpKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSAkY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIEdhbWVDb250cm9sbGVyLnBsYXlUdXJuKGRlY29kZUNvb3JkcygkY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJykpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGNlbGxIaXQgPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3QgZW5jb2RlZENvb3JkcyA9IGAke2Nvb3Jkcy54fSAke2Nvb3Jkcy55fWA7XG4gICAgY29uc3QgJGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuYWN0aXZlID4gW2RhdGEtY29vcmRzPVwiJHtlbmNvZGVkQ29vcmRzfVwiXWApO1xuICAgICRjZWxsLmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICB9XG5cbiAgY29uc3QgdG9nZ2xlQWN0aXZlQm9hcmQgPSAoKSA9PiB7XG4gICAgY29uc3QgJGdhbWVib2FyZENvbnRhaW5lcnMgPSBBcnJheS5mcm9tKCRtYWluLmNoaWxkcmVuKTtcbiAgICAkZ2FtZWJvYXJkQ29udGFpbmVycy5mb3JFYWNoKCRnYW1lYm9hcmQgPT4ge1xuICAgICAgJGdhbWVib2FyZC5maXJzdENoaWxkLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc2hpcFN1bmsgPSAoY29vcmRzQXJyYXkpID0+IHtcbiAgICBjb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuYWN0aXZlID4gW2RhdGEtY29vcmRzPVwiJHtjb29yZHMueH0gJHtjb29yZHMueX1cIl1gKS5jbGFzc0xpc3QuYWRkKCdzdW5rJyk7XG4gICAgfSlcbiAgfVxuXG4gIGNvbnN0IG5ld0dhbWVib2FyZENvbnRhaW5lckRPTSA9IChwbGF5ZXJOYW1lKSA9PiB7XG4gICAgY29uc3QgJGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICRjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnY29udGFpbmVyJyk7XG4gICAgY29uc3QgJGJvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgJGJvYXJkLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyTmFtZX1gKTtcbiAgICAkYm9hcmQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcbiAgICBjb25zdCAkc2hpcHNEaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgJHNoaXBzRGlzcGxheS5jbGFzc0xpc3QuYWRkKCdzaGlwcy1kaXNwbGF5Jyk7XG4gICAgJGNvbnRhaW5lci5hcHBlbmRDaGlsZCgkYm9hcmQpO1xuICAgICRjb250YWluZXIuYXBwZW5kQ2hpbGQoJHNoaXBzRGlzcGxheSk7XG4gICAgaWYgKG1vZGUgPT09ICdQTEFDRScpICRtb2RhbC5hcHBlbmRDaGlsZCgkY29udGFpbmVyKTtcbiAgICBlbHNlICRtYWluLmFwcGVuZENoaWxkKCRjb250YWluZXIpO1xuICAgIHJldHVybiAkY29udGFpbmVyO1xuICB9XG5cbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKHBsYXllciwgcGxheWVyTmFtZSwgYm9hcmQsIGlzQWN0aXZlID0gZmFsc2UpID0+IHtcbiAgICBtb2RlID0gcGxheWVyTmFtZSA9PT0gJ3NhbXBsZScgPyAnUExBQ0UnOiAnUExBWSc7XG4gICAgY29uc3QgJGNvbnRhaW5lciA9IG5ld0dhbWVib2FyZENvbnRhaW5lckRPTShwbGF5ZXJOYW1lKTtcbiAgICBpZiAoaXNBY3RpdmUpICRjb250YWluZXIuZmlyc3RDaGlsZC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICBib2FyZC5mb3JFYWNoKGNlbGwgPT4gJGNvbnRhaW5lci5maXJzdENoaWxkLmFwcGVuZENoaWxkKG5ld0NlbGxET00oY2VsbCkpKTtcbiAgfVxuXG4gIGNvbnN0IG5ld1NoaXBET00gPSAoc2hpcCwgaXNQbGFjZWQgPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0ICRzaGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgJHNoaXAudGV4dENvbnRlbnQgPSBzaGlwLm5hbWU7XG4gICAgaWYgKHNoaXAuaXNTdW5rKCkgfHwgKG1vZGUgPT09ICdQTEFDRScgJiYgaXNQbGFjZWQpKSAkc2hpcC5jbGFzc0xpc3QuYWRkKCdzdW5rJyk7XG4gICAgcmV0dXJuICRzaGlwO1xuICB9XG5cbiAgY29uc3QgdXBkYXRlU2hpcHNEaXNwbGF5ID0gKHBsYXllck5hbWUsIHNoaXBzLCBzaGlwTnVtID0gLTEpID0+IHtcbiAgICBjb25zdCAkc2hpcHNEaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7cGxheWVyTmFtZX1gKS5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgJHNoaXBzRGlzcGxheS50ZXh0Q29udGVudCA9ICcnO1xuICAgIHNoaXBzLmZvckVhY2goKHNoaXAsIGluZGV4KSA9PiB7XG4gICAgICAkc2hpcHNEaXNwbGF5LmFwcGVuZENoaWxkKG5ld1NoaXBET00oc2hpcCwgaW5kZXggPD0gc2hpcE51bSkpO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJHYW1lYm9hcmQsXG4gICAgdXBkYXRlU2hpcHNEaXNwbGF5LFxuICAgIGNlbGxIaXQsXG4gICAgc2hpcFN1bmssXG4gICAgdG9nZ2xlQWN0aXZlQm9hcmQsXG4gIH07XG5cbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFVJOyIsImltcG9ydCBVSSBmcm9tIFwiLi4vTW9kdWxlcy9VSVwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAoc2l6ZSkgPT4ge1xuXG4gIGNvbnN0IHNoaXBzID0gW107XG5cbiAgY29uc3QgY2VsbCA9ICh4LCB5KSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvb3Jkczoge3gsIHl9LFxuICAgICAgaGFzU2hpcDogJycsXG4gICAgICBpc1Nob3Q6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IF9tYWtlR3JpZCA9IChzaXplKSA9PiB7XG4gICAgY29uc3QgYXJyID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplICogc2l6ZTsgaSsrKSB7XG4gICAgICBhcnIucHVzaChjZWxsKGkgJSBzaXplLCBNYXRoLmZsb29yKGkgLyBzaXplKSkpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xuICB9XG5cbiAgY29uc3QgYm9hcmQgPSBfbWFrZUdyaWQoc2l6ZSk7XG4gIGNvbnN0IGF0ID0gKGNvb3JkcykgPT4gYm9hcmRbY29vcmRzLnggKyBjb29yZHMueSAqIHNpemVdO1xuXG4gIGNvbnN0IGlzVmFsaWRBdHRhY2sgPSAoY29vcmRzKSA9PiB7XG4gICAgcmV0dXJuICFhdChjb29yZHMpLmlzU2hvdDtcbiAgfVxuXG4gIGNvbnN0IGlzU2hpcEhpdCA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gYXQoY29vcmRzKS5oYXNTaGlwICE9PSAnJztcbiAgfVxuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGF0KGNvb3Jkcyk7XG4gICAgY2VsbC5pc1Nob3QgPSB0cnVlO1xuICAgIFVJLmNlbGxIaXQoY29vcmRzKTtcbiAgICBpZiAoY2VsbC5oYXNTaGlwKSB7XG4gICAgICBjb25zdCBzaGlwID0gc2hpcHMuZmluZChzaGlwID0+IHNoaXAubmFtZSA9PT0gY2VsbC5oYXNTaGlwKTtcbiAgICAgIHNoaXAuaGl0KCk7XG4gICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgc2hpcFN1bmsoc2hpcC5uYW1lKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBzZXRTaGlwID0gKHNoaXAsIGNvb3JkcywgYXhpcyA9ICd4JykgPT4ge1xuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gICAgbGV0IG5ld0Nvb3JkcyA9IGNvb3JkcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgYXQobmV3Q29vcmRzKS5oYXNTaGlwID0gc2hpcC5uYW1lO1xuICAgICAgYXhpcyA9PT0gJ3gnID8gbmV3Q29vcmRzLngrKzogbmV3Q29vcmRzLnkrKztcbiAgICB9XG4gIH1cblxuICBjb25zdCBzaGlwU3VuayA9IChzaGlwTmFtZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKHNoaXBOYW1lKTtcbiAgICBjb25zdCBjb29yZHNBcnJheSA9IGJvYXJkLmZpbHRlcihjZWxsID0+IGNlbGwuaGFzU2hpcCA9PT0gc2hpcE5hbWUpLm1hcChjZWxsID0+IGNlbGwuY29vcmRzKTtcbiAgICBVSS5zaGlwU3Vuayhjb29yZHNBcnJheSk7XG4gIH1cblxuICBjb25zdCBpc0NvbGxpc2lvbnMgPSAoc2hpcENvb3Jkc0FycmF5KSA9PiB7XG4gICAgZm9yIChjb25zdCBzaGlwQ29vcmRzIG9mIHNoaXBDb29yZHNBcnJheSkge1xuICAgICAgaWYgKHNoaXBDb29yZHMueCA+IHNpemUgLSAxIHx8IHNoaXBDb29yZHMueSA+IHNpemUgLSAxKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChhdChzaGlwQ29vcmRzKS5oYXNTaGlwICE9PSAnJykgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmQ7XG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4gc2hpcHM7XG5cbiAgcmV0dXJuIHtcbiAgICBhdCxcbiAgICBpc1ZhbGlkQXR0YWNrLFxuICAgIGlzU2hpcEhpdCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIHNldFNoaXAsXG4gICAgaXNDb2xsaXNpb25zLFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBHYW1lYm9hcmQ7IiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIlxuXG5jb25zdCBQbGF5ZXIgPSAobmFtZSkgPT4ge1xuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZ2FtZWJvYXJkOiBHYW1lYm9hcmQoMTApLFxuICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyOyIsImNvbnN0IFNoaXAgPSAobGVuZ3RoLCBuYW1lKSA9PiB7XG4gIGNvbnN0IHNoaXBMZW5ndGggPSBsZW5ndGg7XG4gIGxldCBoaXRDb3VudCA9IDA7XG5cbiAgLy8gR2V0dGVyc1xuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBzaGlwTGVuZ3RoO1xuICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0Q291bnQ7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdENvdW50Kys7XG4gIH1cblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdENvdW50ID49IHNoaXBMZW5ndGg7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZ2V0TGVuZ3RoLFxuICAgIGdldEhpdHMsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU2hpcDsiLCJjb25zdCBBSSA9ICgoKSA9PiB7XG5cbiAgY29uc3QgZ2V0Q29vcmRzID0gKGJvYXJkKSA9PiB7XG4gICAgY29uc3QgdmFsaWRDZWxscyA9IGJvYXJkLmZpbHRlcihjZWxsID0+ICFjZWxsLmlzU2hvdCk7XG4gICAgY29uc3QgY29vcmRzID0gdmFsaWRDZWxsc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENlbGxzLmxlbmd0aCldLmNvb3JkcztcbiAgICByZXR1cm4gY29vcmRzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0Q29vcmRzLFxuICB9O1xuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBBSTsiLCJpbXBvcnQgUGxheWVyIGZyb20gXCIuLi9GYWN0b3JpZXMvUGxheWVyXCJcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9GYWN0b3JpZXMvU2hpcFwiO1xuaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5pbXBvcnQgQUkgZnJvbSBcIi4vQUlQbGF5ZXJcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL1BsYWNlU2hpcHNcIjtcblxuY29uc3QgR2FtZUNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuXG4gIGNvbnN0IHBsYXllcjEgPSBQbGF5ZXIoJ1AxJyk7XG4gIGNvbnN0IHBsYXllcjIgPSBQbGF5ZXIoJ1AyJyk7XG5cbiAgZnVuY3Rpb24gc2xlZXAobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG4gIH0gXG5cbiAgY29uc3Qgb3Bwb25lbnQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllcjEuaXNBY3RpdmUgPyBwbGF5ZXIyOiBwbGF5ZXIxO1xuICB9XG5cbiAgY29uc3QgdG9nZ2xlQWN0aXZlUGxheWVyID0gKCkgPT4ge1xuICAgIHBsYXllcjEuaXNBY3RpdmUgPSAhcGxheWVyMS5pc0FjdGl2ZTtcbiAgICBwbGF5ZXIyLmlzQWN0aXZlID0gIXBsYXllcjIuaXNBY3RpdmU7XG4gICAgVUkudG9nZ2xlQWN0aXZlQm9hcmQoKTtcbiAgfVxuXG4gIGNvbnN0IGluaXRQbGF5ZXIxID0gKCkgPT4ge1xuICAgIHBsYXllcjEuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHBsYXllcjEuZ2FtZWJvYXJkID0gUGxhY2VTaGlwcy5nZXRTYW1wbGVQbGF5ZXIoKS5nYW1lYm9hcmQ7XG4gICAgVUkucmVuZGVyR2FtZWJvYXJkKCdQMScsIHBsYXllcjEubmFtZSwgcGxheWVyMS5nYW1lYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gICAgVUkudXBkYXRlU2hpcHNEaXNwbGF5KHBsYXllcjEubmFtZSwgcGxheWVyMS5nYW1lYm9hcmQuZ2V0U2hpcHMoKSk7XG4gIH1cblxuICBjb25zdCBpbml0UGxheWVyMiA9ICgpID0+IHtcbiAgICBwbGF5ZXIyLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgbGV0IHNoaXBzID0gW1NoaXAoMywgJ2VuZW15YScpLCBTaGlwKDIsICdlbmVteWInKV07XG4gICAgcGxheWVyMi5nYW1lYm9hcmQuc2V0U2hpcChzaGlwc1swXSwge3g6IDEsIHk6IDF9LCAneCcpO1xuICAgIHBsYXllcjIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbMV0sIHt4OiAyLCB5OiA1fSwgJ3knKTtcbiAgICBVSS5yZW5kZXJHYW1lYm9hcmQoJ1AyJywgcGxheWVyMi5uYW1lLCBwbGF5ZXIyLmdhbWVib2FyZC5nZXRCb2FyZCgpLCB0cnVlKTtcbiAgICBVSS51cGRhdGVTaGlwc0Rpc3BsYXkocGxheWVyMi5uYW1lLCBwbGF5ZXIyLmdhbWVib2FyZC5nZXRTaGlwcygpKTtcblxuICB9XG5cbiAgY29uc3QgcGxheVR1cm4gPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3Qgb3Bwb25lbnRCb2FyZCA9IG9wcG9uZW50KCkuZ2FtZWJvYXJkO1xuICAgIGlmICghb3Bwb25lbnRCb2FyZC5pc1ZhbGlkQXR0YWNrKGNvb3JkcykpIHJldHVybjtcbiAgICBvcHBvbmVudEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRzKTtcbiAgICBVSS51cGRhdGVTaGlwc0Rpc3BsYXkob3Bwb25lbnQoKS5uYW1lLCBvcHBvbmVudEJvYXJkLmdldFNoaXBzKCkpO1xuICAgIGlmICghb3Bwb25lbnRCb2FyZC5pc1NoaXBIaXQoY29vcmRzKSkgdG9nZ2xlQWN0aXZlUGxheWVyKCk7XG4gICAgcGxheUdhbWUoKTtcbiAgfVxuXG4gIGNvbnN0IHBsYXlHYW1lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmIChwbGF5ZXIyLmlzQWN0aXZlKSB7XG4gICAgICBhd2FpdCBzbGVlcCgzMDApO1xuICAgICAgcGxheVR1cm4oQUkuZ2V0Q29vcmRzKG9wcG9uZW50KCkuZ2FtZWJvYXJkLmdldEJvYXJkKCkpKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIGluaXRQbGF5ZXIxKCk7XG4gICAgaW5pdFBsYXllcjIoKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgcGxheVR1cm4sXG4gIH07XG5cbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVDb250cm9sbGVyOyIsImltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9HYW1lQ29udHJvbGxlclwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi4vRmFjdG9yaWVzL1BsYXllclwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4uL0ZhY3Rvcmllcy9TaGlwXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcblxuY29uc3QgUGxhY2VTaGlwcyA9ICgoKSA9PiB7XG4gIGNvbnN0IHBsYXllciA9IFBsYXllcignc2FtcGxlJyk7XG4gIGNvbnN0IHNoaXBzID0gW1NoaXAoNCwgJ2FrJyksIFNoaXAoMiwgJ2InKSwgU2hpcCg1LCAnYycpLCBTaGlwKDQsICdkJyksIFNoaXAoMiwgJ2UnKV07XG4gIGxldCBjdXJyZW50ID0ge1xuICAgIHNoaXBOdW06IDAsXG4gICAgc2hpcENvb3Jkc0FycmF5OiBbXSxcbiAgICBheGlzOiAneCdcbiAgfTtcbiAgY29uc3QgJG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XG5cbiAgLy8gVXRpbCBcblxuICBjb25zdCBjZWxsQXQgPSAoY29vcmRzKSA9PiB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWNvb3Jkcz1cIiR7Y29vcmRzLnh9ICR7Y29vcmRzLnl9XCJdYCk7XG4gIH1cblxuICAvLyBET01cblxuICBjb25zdCBzaG93U2hpcCA9IChjb29yZHMpID0+IHtcbiAgICBpZiAoY3VycmVudC5zaGlwQ29vcmRzQXJyYXkubGVuZ3RoICE9PSAwKSB7XG4gICAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiB7XG4gICAgICAgIGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5yZW1vdmUoJ3RlbXAnKTtcbiAgICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LnJlbW92ZSgnaW52YWxpZCcpO1xuICAgICAgfSlcbiAgICB9XG4gICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkgPSBtYWtlU2hpcChjb29yZHMpO1xuICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IHtcbiAgICAgIGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5hZGQoXCJ0ZW1wXCIpO1xuICAgIH0pXG4gICAgaWYgKCFpc1NoaXBWYWxpZCgpKSB7XG4gICAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiB7XG4gICAgICAgIGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5hZGQoXCJpbnZhbGlkXCIpO1xuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBjb25zdCBtYWtlU2hpcCA9IChjb29yZHMpID0+IHtcbiAgICBsZXQgc2hpcENvb3Jkc0FycmF5ID0gW107XG4gICAgbGV0IG5ld0Nvb3JkcyA9IGNvb3JkcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBzW2N1cnJlbnQuc2hpcE51bV0uZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgc2hpcENvb3Jkc0FycmF5LnB1c2goe3g6IG5ld0Nvb3Jkcy54LCB5OiBuZXdDb29yZHMueX0pO1xuICAgICAgY3VycmVudC5heGlzID09PSAneCcgPyBuZXdDb29yZHMueCsrOiBuZXdDb29yZHMueSsrO1xuICAgICAgaWYgKG5ld0Nvb3Jkcy54ID4gOSB8fCBuZXdDb29yZHMueSA+IDkpIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gc2hpcENvb3Jkc0FycmF5O1xuICB9XG5cbiAgY29uc3QgaXNTaGlwVmFsaWQgPSAoKSA9PiB7XG4gICAgcmV0dXJuICghcGxheWVyLmdhbWVib2FyZC5pc0NvbGxpc2lvbnMoY3VycmVudC5zaGlwQ29vcmRzQXJyYXkpICYmIFxuICAgICAgICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5Lmxlbmd0aCA9PT0gc2hpcHNbY3VycmVudC5zaGlwTnVtXS5nZXRMZW5ndGgoKSk7XG4gIH1cblxuICBcbiAgY29uc3QgcGxhY2VTaGlwID0gKGNvb3JkcykgPT4ge1xuICAgIGlmICghaXNTaGlwVmFsaWQoKSkgcmV0dXJuO1xuICAgIHBsYXllci5nYW1lYm9hcmQuc2V0U2hpcChzaGlwc1tjdXJyZW50LnNoaXBOdW0rK10sIGNvb3JkcywgY3VycmVudC5heGlzKTtcbiAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QuYWRkKCdzaGlwJykpO1xuICAgIFVJLnVwZGF0ZVNoaXBzRGlzcGxheShwbGF5ZXIubmFtZSwgc2hpcHMsIGN1cnJlbnQuc2hpcE51bSAtIDEpO1xuICAgIGlmIChjdXJyZW50LnNoaXBOdW0gPT09IHNoaXBzLmxlbmd0aCkge1xuICAgICAgJG1vZGFsLnJlbW92ZSgpO1xuICAgICAgR2FtZUNvbnRyb2xsZXIuaW5pdCgpO1xuICAgIH1cbiAgfVxuICBcbiAgY29uc3QgZ2V0U2FtcGxlUGxheWVyID0gKCkgPT4gcGxheWVyO1xuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgVUkucmVuZGVyR2FtZWJvYXJkKCdzYW1wbGUnLCBwbGF5ZXIubmFtZSwgcGxheWVyLmdhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgICBVSS51cGRhdGVTaGlwc0Rpc3BsYXkocGxheWVyLm5hbWUsIHNoaXBzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsICh7IGtleSB9KSA9PiB7XG4gICAgICBpZiAoa2V5ID09PSAnUicgfHwga2V5ID09PSAncicpIHtcbiAgICAgICAgY3VycmVudC5heGlzID0gY3VycmVudC5heGlzID09PSAneCcgPyAneSc6ICd4JztcbiAgICAgICAgc2hvd1NoaXAoY3VycmVudC5zaGlwQ29vcmRzQXJyYXlbMF0sIGN1cnJlbnQuYXhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgcGxhY2VTaGlwLFxuICAgIHNob3dTaGlwLFxuICAgIGdldFNhbXBsZVBsYXllcixcbiAgfVxuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBQbGFjZVNoaXBzOyIsIi8vIGltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9Nb2R1bGVzL0dhbWVDb250cm9sbGVyXCI7XG5pbXBvcnQgUGxhY2VTaGlwcyBmcm9tIFwiLi9Nb2R1bGVzL1BsYWNlU2hpcHNcIjtcblxuUGxhY2VTaGlwcy5pbml0KCk7Il0sIm5hbWVzIjpbIiRtYWluIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiJG1vZGFsIiwibW9kZSIsImRlY29kZUNvb3JkcyIsImNvb3Jkc1N0cmluZyIsImNvb3Jkc0FycmF5Iiwic3BsaXQiLCJ4IiwieSIsInJlbmRlckdhbWVib2FyZCIsInBsYXllciIsInBsYXllck5hbWUiLCJib2FyZCIsImlzQWN0aXZlIiwiJGNvbnRhaW5lciIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCIkYm9hcmQiLCIkc2hpcHNEaXNwbGF5IiwiYXBwZW5kQ2hpbGQiLCJuZXdHYW1lYm9hcmRDb250YWluZXJET00iLCJmaXJzdENoaWxkIiwiZm9yRWFjaCIsImNlbGwiLCIkY2VsbCIsInNldEF0dHJpYnV0ZSIsImNvb3JkcyIsImhhc1NoaXAiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0QXR0cmlidXRlIiwiYWRkQ2VsbExpc3RlbmVyIiwibmV3Q2VsbERPTSIsInVwZGF0ZVNoaXBzRGlzcGxheSIsInNoaXBzIiwic2hpcE51bSIsIm5leHRFbGVtZW50U2libGluZyIsInRleHRDb250ZW50Iiwic2hpcCIsImluZGV4IiwiaXNQbGFjZWQiLCIkc2hpcCIsIm5hbWUiLCJpc1N1bmsiLCJuZXdTaGlwRE9NIiwiY2VsbEhpdCIsImVuY29kZWRDb29yZHMiLCJzaGlwU3VuayIsInRvZ2dsZUFjdGl2ZUJvYXJkIiwiQXJyYXkiLCJmcm9tIiwiY2hpbGRyZW4iLCIkZ2FtZWJvYXJkIiwidG9nZ2xlIiwic2l6ZSIsImFyciIsImkiLCJwdXNoIiwiTWF0aCIsImZsb29yIiwiaXNTaG90IiwiX21ha2VHcmlkIiwiYXQiLCJpc1ZhbGlkQXR0YWNrIiwiaXNTaGlwSGl0IiwicmVjZWl2ZUF0dGFjayIsImZpbmQiLCJoaXQiLCJzaGlwTmFtZSIsImNvbnNvbGUiLCJsb2ciLCJmaWx0ZXIiLCJtYXAiLCJzZXRTaGlwIiwiYXhpcyIsIm5ld0Nvb3JkcyIsImdldExlbmd0aCIsImlzQ29sbGlzaW9ucyIsInNoaXBDb29yZHNBcnJheSIsInNoaXBDb29yZHMiLCJnZXRCb2FyZCIsImdldFNoaXBzIiwiZ2FtZWJvYXJkIiwibGVuZ3RoIiwic2hpcExlbmd0aCIsImhpdENvdW50IiwiZ2V0SGl0cyIsInZhbGlkQ2VsbHMiLCJyYW5kb20iLCJwbGF5ZXIxIiwicGxheWVyMiIsIm9wcG9uZW50IiwicGxheVR1cm4iLCJvcHBvbmVudEJvYXJkIiwicGxheUdhbWUiLCJhc3luYyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImluaXQiLCJpbml0UGxheWVyMiIsImN1cnJlbnQiLCJjZWxsQXQiLCJzaG93U2hpcCIsInJlbW92ZSIsIm1ha2VTaGlwIiwiaXNTaGlwVmFsaWQiLCJrZXkiLCJwbGFjZVNoaXAiLCJnZXRTYW1wbGVQbGF5ZXIiXSwic291cmNlUm9vdCI6IiJ9