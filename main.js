(()=>{"use strict";const e=(()=>{const e=document.querySelector(".P1"),t=document.querySelector(".P2"),s=()=>{t.classList.add("active")};return s(),{init:s,renderGameboard:(s,a,r)=>{let i="P1"===s?e:t;i.classList.add(a),r.forEach((e=>i.appendChild((e=>{const t=document.createElement("div");return t.classList.add("cell"),t.setAttribute("data-coords",`${e.coords.x} ${e.coords.y}`),e.hasShip&&t.classList.add("ship"),(e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-coords").split(" "),s={x:+t[0],y:+t[1]};o.playTurn(s)}))})(t),t})(e))))},cellHit:e=>{const t=`${e.x} ${e.y}`;document.querySelector(`.active > [data-coords="${t}"]`).classList.add("hit")},shipSunk:e=>{e.forEach((e=>{document.querySelector(`.active > [data-coords="${e.x} ${e.y}"]`).classList.add("sunk")}))},toggleActiveBoard:()=>{e.classList.toggle("active"),t.classList.toggle("active")}}})(),t=t=>{const s=[],a=(e=>{const t=[];for(let s=0;s<e*e;s++)t.push({coords:{x:s%e,y:Math.floor(s/e)},hasShip:"",isShot:!1});return t})(t),r=e=>a[e.x+e.y*t];return{at:r,isValidAttack:e=>!r(e).isShot,isShipHit:e=>""!==r(e).hasShip,receiveAttack:t=>{const o=r(t);if(o.isShot=!0,e.cellHit(t),o.hasShip){const t=s.find((e=>e.name===o.hasShip));t.hit(),t.isSunk()&&(t=>{console.log(t);const s=a.filter((e=>e.hasShip===t)).map((e=>e.coords));e.shipSunk(s)})(t.name)}},setShip:(e,t,a="x")=>{s.push(e);let o=t;for(let t=0;t<e.getLength();t++)r(o).hasShip=e.name,"x"===a?o.x++:o.y++},isCollisions:e=>{for(const s of e){if(s.x>t-1||s.y>t-1)return!0;if(""!==r(s).hasShip)return!0}return!1},getBoard:()=>a}},s=e=>({name:e,gameboard:t(10),isActive:!1}),a=(e,t)=>{const s=e;let a=0;return{name:t,getLength:()=>s,getHits:()=>a,hit:()=>{a++},isSunk:()=>s===a}},r=e=>{const t=e.filter((e=>!e.isShot));return t[Math.floor(Math.random()*t.length)].coords},o=(()=>{const t=s("player"),o=s("enemy"),d=()=>t.isActive?o:t,c=s=>{const a=d().gameboard;a.isValidAttack(s)&&(a.receiveAttack(s),a.isShipHit(s)||(t.isActive=!t.isActive,o.isActive=!o.isActive,e.toggleActiveBoard()),n())},n=async()=>{o.isActive&&(await(300,new Promise((e=>setTimeout(e,300)))),c(r(d().gameboard.getBoard())))};return{init:()=>{t.isActive=!0,t.gameboard=i.getSamplePlayer().gameboard,e.renderGameboard("P1",t.name,t.gameboard.getBoard()),(()=>{o.isActive=!1;let t=[a(3,"enemya"),a(2,"enemyb")];o.gameboard.setShip(t[0],{x:1,y:1},"x"),o.gameboard.setShip(t[1],{x:2,y:5},"y"),e.renderGameboard("P2",o.name,o.gameboard.getBoard())})()},playTurn:c}})(),i=(()=>{const e=s("sample"),t=[a(4,"ak"),a(2,"b"),a(5,"c"),a(4,"d"),a(2,"e")];let r={shipNum:0,shipCoordsArray:[],axis:"x"};const i=document.querySelector(".modal"),d=document.querySelector(".sample"),c=e=>{const t=e.split(" ");return{x:+t[0],y:+t[1]}},n=e=>document.querySelector(`[data-coords="${e.x} ${e.y}"]`),l=(e,t)=>{0!==r.shipCoordsArray.length&&r.shipCoordsArray.forEach((e=>{n(e).classList.remove("temp"),n(e).classList.remove("invalid")})),r.shipCoordsArray=[],h(e,t),m()||r.shipCoordsArray.forEach((e=>{n(e).classList.add("invalid")})),r.shipCoordsArray.forEach((e=>{n(e).classList.add("temp")}))},h=(e,s)=>{let a=e;for(let e=0;e<t[r.shipNum].getLength()&&(r.shipCoordsArray.push({x:a.x,y:a.y}),"x"===s?a.x++:a.y++,!(a.x>9||a.y>9));e++);},m=()=>!e.gameboard.isCollisions(r.shipCoordsArray)&&r.shipCoordsArray.length===t[r.shipNum].getLength(),p=(e,t,s)=>{let a=d;a.classList.add(t),s.forEach((e=>a.appendChild((e=>{const t=document.createElement("div");return t.classList.add("cell"),t.setAttribute("data-coords",`${e.coords.x} ${e.coords.y}`),(async e=>{e.addEventListener("click",(()=>{u(c(e.getAttribute("data-coords")),r.axis),Promise.resolve(c(e.getAttribute("data-coords")))})),e.addEventListener("mouseover",(()=>{l(c(e.getAttribute("data-coords")),r.axis)}))})(t),t})(e))))},u=(s,a)=>{m()&&(e.gameboard.setShip(t[r.shipNum++],s,a),r.shipCoordsArray.forEach((e=>{const t=n(e);t.classList.add("ship"),t.classList.remove("temp")})),r.shipNum===t.length-1&&(i.remove(),o.init()))};return{init:()=>{p(0,e.name,e.gameboard.getBoard()),document.addEventListener("keyup",(({key:e})=>{"R"!==e&&"r"!==e||(r.axis="x"===r.axis?"y":"x",l(r.shipCoordsArray[0],r.axis))}))},getSamplePlayer:()=>e}})();i.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxRQUFRTyxFQUFheEUsRUFBTVMsYUFBYSxvQkFHbERULEVBQU1PLGlCQUFpQixhQUFhLEtBQ2xDb0UsRUFBU0gsRUFBYXhFLEVBQU1TLGFBQWEsZ0JBQWlCMkQsRUFBUTFCLFVBWHBFL0IsQ0FBZ0JYLEdBQ1RBLEdBbURrQ1ksQ0FBV2QsT0FHaERpRixFQUFZLENBQUM1RSxFQUFRdUMsS0FDcEJvQyxNQUNMckYsRUFBT3dELFVBQVVSLFFBQVF0QixFQUFNaUQsRUFBUUMsV0FBWWxFLEVBQVF1QyxHQUMzRDBCLEVBQVF0QixnQkFBZ0JqRCxTQUFRTSxJQUM5QixNQUFNSCxFQUFRMEUsRUFBT3ZFLEdBQ3JCSCxFQUFNVixVQUFVQyxJQUFJLFFBQ3BCUyxFQUFNVixVQUFVc0YsT0FBTyxXQUVyQlIsRUFBUUMsVUFBWWxELEVBQU1nQyxPQUFTLElBQ3JDbUIsRUFBT00sU0FDUCxZQWdCSixNQUFPLENBQ0x2RixLQVhXLEtBQ1hHLEVBQWdCLEVBQVVDLEVBQU93QyxLQUFNeEMsRUFBT3dELFVBQVVELFlBQ3hEOUQsU0FBU3FCLGlCQUFpQixTQUFTLEVBQUd5RSxJQUFBQSxNQUN4QixNQUFSQSxHQUF1QixNQUFSQSxJQUNqQlosRUFBUTFCLEtBQXdCLE1BQWpCMEIsRUFBUTFCLEtBQWUsSUFBSyxJQUMzQ2lDLEVBQVNQLEVBQVF0QixnQkFBZ0IsR0FBSXNCLEVBQVExQixXQU9qRHVDLGdCQWRzQixJQUFNeEYsSUFqR2IsR0NEbkIsVSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9VSS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3Rvcmllcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9GYWN0b3JpZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL0FJUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9HYW1lQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvUGxhY2VTaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9HYW1lQ29udHJvbGxlclwiO1xuXG5cbmNvbnN0IFVJID0gKCgpID0+IHtcbiAgY29uc3QgJHAxR2FtZWJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLlAxJyk7XG4gIGNvbnN0ICRwMkdhbWVib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5QMicpO1xuICBcbiAgY29uc3QgbmV3Q2VsbERPTSA9IChjZWxsKSA9PiB7XG4gICAgICBjb25zdCAkY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgJGNlbGwuY2xhc3NMaXN0LmFkZCgnY2VsbCcpO1xuICAgICAgJGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLWNvb3JkcycsIGAke2NlbGwuY29vcmRzLnh9ICR7Y2VsbC5jb29yZHMueX1gKTtcbiAgICAgIGlmIChjZWxsLmhhc1NoaXApICRjZWxsLmNsYXNzTGlzdC5hZGQoJ3NoaXAnKTtcbiAgICAgIGFkZENlbGxMaXN0ZW5lcigkY2VsbCk7XG4gICAgICByZXR1cm4gJGNlbGw7XG4gIH1cblxuICBjb25zdCBhZGRDZWxsTGlzdGVuZXIgPSAoJGNlbGwpID0+IHtcbiAgICAkY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvb3Jkc0FycmF5ID0gJGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLWNvb3JkcycpLnNwbGl0KCcgJyk7XG4gICAgICBjb25zdCBjb29yZHMgPSB7eDogK2Nvb3Jkc0FycmF5WzBdLCB5OiArY29vcmRzQXJyYXlbMV19O1xuICAgICAgR2FtZUNvbnRyb2xsZXIucGxheVR1cm4oY29vcmRzKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGNlbGxIaXQgPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3QgZW5jb2RlZENvb3JkcyA9IGAke2Nvb3Jkcy54fSAke2Nvb3Jkcy55fWA7XG4gICAgY29uc3QgJGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuYWN0aXZlID4gW2RhdGEtY29vcmRzPVwiJHtlbmNvZGVkQ29vcmRzfVwiXWApO1xuICAgICRjZWxsLmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICB9XG5cbiAgY29uc3QgdG9nZ2xlQWN0aXZlQm9hcmQgPSAoKSA9PiB7XG4gICAgJHAxR2FtZWJvYXJkLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgICRwMkdhbWVib2FyZC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgfVxuXG4gIGNvbnN0IHNoaXBTdW5rID0gKGNvb3Jkc0FycmF5KSA9PiB7XG4gICAgY29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmFjdGl2ZSA+IFtkYXRhLWNvb3Jkcz1cIiR7Y29vcmRzLnh9ICR7Y29vcmRzLnl9XCJdYCkuY2xhc3NMaXN0LmFkZCgnc3VuaycpO1xuICAgIH0pXG4gIH1cblxuICBjb25zdCByZW5kZXJHYW1lYm9hcmQgPSAocGxheWVyLCBwbGF5ZXJOYW1lLCBib2FyZCkgPT4ge1xuICAgIGxldCAkYm9hcmQgPSBwbGF5ZXIgPT09ICdQMScgPyAkcDFHYW1lYm9hcmQgOiAkcDJHYW1lYm9hcmQ7XG4gICAgJGJvYXJkLmNsYXNzTGlzdC5hZGQocGxheWVyTmFtZSk7XG4gICAgYm9hcmQuZm9yRWFjaChjZWxsID0+ICRib2FyZC5hcHBlbmRDaGlsZChuZXdDZWxsRE9NKGNlbGwpKSk7XG4gIH1cblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgICRwMkdhbWVib2FyZC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgfVxuXG4gIGluaXQoKTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICAgIGNlbGxIaXQsXG4gICAgc2hpcFN1bmssXG4gICAgdG9nZ2xlQWN0aXZlQm9hcmQsXG4gIH07XG5cbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFVJOyIsImltcG9ydCBVSSBmcm9tIFwiLi4vTW9kdWxlcy9VSVwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAoc2l6ZSkgPT4ge1xuXG4gIGNvbnN0IHNoaXBzID0gW107XG5cbiAgY29uc3QgY2VsbCA9ICh4LCB5KSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvb3Jkczoge3gsIHl9LFxuICAgICAgaGFzU2hpcDogJycsXG4gICAgICBpc1Nob3Q6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IF9tYWtlR3JpZCA9IChzaXplKSA9PiB7XG4gICAgY29uc3QgYXJyID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplICogc2l6ZTsgaSsrKSB7XG4gICAgICBhcnIucHVzaChjZWxsKGkgJSBzaXplLCBNYXRoLmZsb29yKGkgLyBzaXplKSkpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xuICB9XG5cbiAgY29uc3QgYm9hcmQgPSBfbWFrZUdyaWQoc2l6ZSk7XG4gIGNvbnN0IGF0ID0gKGNvb3JkcykgPT4gYm9hcmRbY29vcmRzLnggKyBjb29yZHMueSAqIHNpemVdO1xuXG4gIGNvbnN0IGlzVmFsaWRBdHRhY2sgPSAoY29vcmRzKSA9PiB7XG4gICAgcmV0dXJuICFhdChjb29yZHMpLmlzU2hvdDtcbiAgfVxuXG4gIGNvbnN0IGlzU2hpcEhpdCA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gYXQoY29vcmRzKS5oYXNTaGlwICE9PSAnJztcbiAgfVxuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGF0KGNvb3Jkcyk7XG4gICAgY2VsbC5pc1Nob3QgPSB0cnVlO1xuICAgIFVJLmNlbGxIaXQoY29vcmRzKTtcbiAgICBpZiAoY2VsbC5oYXNTaGlwKSB7XG4gICAgICBjb25zdCBzaGlwID0gc2hpcHMuZmluZChzaGlwID0+IHNoaXAubmFtZSA9PT0gY2VsbC5oYXNTaGlwKTtcbiAgICAgIHNoaXAuaGl0KCk7XG4gICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgc2hpcFN1bmsoc2hpcC5uYW1lKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBzZXRTaGlwID0gKHNoaXAsIGNvb3JkcywgYXhpcyA9ICd4JykgPT4ge1xuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gICAgbGV0IG5ld0Nvb3JkcyA9IGNvb3JkcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgYXQobmV3Q29vcmRzKS5oYXNTaGlwID0gc2hpcC5uYW1lO1xuICAgICAgYXhpcyA9PT0gJ3gnID8gbmV3Q29vcmRzLngrKzogbmV3Q29vcmRzLnkrKztcbiAgICB9XG4gIH1cblxuICBjb25zdCBzaGlwU3VuayA9IChzaGlwTmFtZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKHNoaXBOYW1lKTtcbiAgICBjb25zdCBjb29yZHNBcnJheSA9IGJvYXJkLmZpbHRlcihjZWxsID0+IGNlbGwuaGFzU2hpcCA9PT0gc2hpcE5hbWUpLm1hcChjZWxsID0+IGNlbGwuY29vcmRzKTtcbiAgICBVSS5zaGlwU3Vuayhjb29yZHNBcnJheSk7XG4gIH1cblxuICBjb25zdCBpc0NvbGxpc2lvbnMgPSAoc2hpcENvb3Jkc0FycmF5KSA9PiB7XG4gICAgZm9yIChjb25zdCBzaGlwQ29vcmRzIG9mIHNoaXBDb29yZHNBcnJheSkge1xuICAgICAgaWYgKHNoaXBDb29yZHMueCA+IHNpemUgLSAxIHx8IHNoaXBDb29yZHMueSA+IHNpemUgLSAxKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChhdChzaGlwQ29vcmRzKS5oYXNTaGlwICE9PSAnJykgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmQ7XG5cbiAgcmV0dXJuIHtcbiAgICBhdCxcbiAgICBpc1ZhbGlkQXR0YWNrLFxuICAgIGlzU2hpcEhpdCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIHNldFNoaXAsXG4gICAgaXNDb2xsaXNpb25zLFxuICAgIGdldEJvYXJkLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBHYW1lYm9hcmQ7IiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIlxuXG5jb25zdCBQbGF5ZXIgPSAobmFtZSkgPT4ge1xuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZ2FtZWJvYXJkOiBHYW1lYm9hcmQoMTApLFxuICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyOyIsImNvbnN0IFNoaXAgPSAobGVuZ3RoLCBuYW1lKSA9PiB7XG4gIGNvbnN0IHNoaXBMZW5ndGggPSBsZW5ndGg7XG4gIGxldCBoaXRDb3VudCA9IDA7XG5cbiAgLy8gR2V0dGVyc1xuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBzaGlwTGVuZ3RoO1xuICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0Q291bnQ7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdENvdW50Kys7XG4gIH1cblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXBMZW5ndGggPT09IGhpdENvdW50O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGdldExlbmd0aCxcbiAgICBnZXRIaXRzLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNoaXA7IiwiY29uc3QgQUkgPSAoKCkgPT4ge1xuXG4gIGNvbnN0IGdldENvb3JkcyA9IChib2FyZCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkQ2VsbHMgPSBib2FyZC5maWx0ZXIoY2VsbCA9PiAhY2VsbC5pc1Nob3QpO1xuICAgIGNvbnN0IGNvb3JkcyA9IHZhbGlkQ2VsbHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdmFsaWRDZWxscy5sZW5ndGgpXS5jb29yZHM7XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldENvb3JkcyxcbiAgfTtcblxufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgQUk7IiwiaW1wb3J0IFBsYXllciBmcm9tIFwiLi4vRmFjdG9yaWVzL1BsYXllclwiXG5pbXBvcnQgU2hpcCBmcm9tIFwiLi4vRmFjdG9yaWVzL1NoaXBcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9VSVwiO1xuaW1wb3J0IEFJIGZyb20gXCIuL0FJUGxheWVyXCI7XG5pbXBvcnQgUGxhY2VTaGlwcyBmcm9tIFwiLi9QbGFjZVNoaXBzXCI7XG5cbmNvbnN0IEdhbWVDb250cm9sbGVyID0gKCgpID0+IHtcblxuICBjb25zdCBwbGF5ZXIxID0gUGxheWVyKCdwbGF5ZXInKTtcbiAgY29uc3QgcGxheWVyMiA9IFBsYXllcignZW5lbXknKTtcblxuICBmdW5jdGlvbiBzbGVlcChtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfSBcblxuICBjb25zdCBvcHBvbmVudCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGxheWVyMS5pc0FjdGl2ZSA/IHBsYXllcjI6IHBsYXllcjE7XG4gIH1cblxuICBjb25zdCB0b2dnbGVBY3RpdmVQbGF5ZXIgPSAoKSA9PiB7XG4gICAgcGxheWVyMS5pc0FjdGl2ZSA9ICFwbGF5ZXIxLmlzQWN0aXZlO1xuICAgIHBsYXllcjIuaXNBY3RpdmUgPSAhcGxheWVyMi5pc0FjdGl2ZTtcbiAgICBVSS50b2dnbGVBY3RpdmVCb2FyZCgpO1xuICB9XG5cbiAgY29uc3QgaW5pdFBsYXllcjEgPSAoKSA9PiB7XG4gICAgcGxheWVyMS5pc0FjdGl2ZSA9IHRydWU7XG4gICAgcGxheWVyMS5nYW1lYm9hcmQgPSBQbGFjZVNoaXBzLmdldFNhbXBsZVBsYXllcigpLmdhbWVib2FyZDtcbiAgICBVSS5yZW5kZXJHYW1lYm9hcmQoJ1AxJywgcGxheWVyMS5uYW1lLCBwbGF5ZXIxLmdhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgfVxuXG4gIGNvbnN0IGluaXRQbGF5ZXIyID0gKCkgPT4ge1xuICAgIHBsYXllcjIuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICBsZXQgc2hpcHMgPSBbU2hpcCgzLCAnZW5lbXlhJyksIFNoaXAoMiwgJ2VuZW15YicpXTtcbiAgICBwbGF5ZXIyLmdhbWVib2FyZC5zZXRTaGlwKHNoaXBzWzBdLCB7eDogMSwgeTogMX0sICd4Jyk7XG4gICAgcGxheWVyMi5nYW1lYm9hcmQuc2V0U2hpcChzaGlwc1sxXSwge3g6IDIsIHk6IDV9LCAneScpO1xuICAgIFVJLnJlbmRlckdhbWVib2FyZCgnUDInLCBwbGF5ZXIyLm5hbWUsIHBsYXllcjIuZ2FtZWJvYXJkLmdldEJvYXJkKCkpO1xuICB9XG5cbiAgY29uc3QgcGxheVR1cm4gPSAoY29vcmRzKSA9PiB7XG4gICAgY29uc3Qgb3Bwb25lbnRCb2FyZCA9IG9wcG9uZW50KCkuZ2FtZWJvYXJkO1xuICAgIGlmICghb3Bwb25lbnRCb2FyZC5pc1ZhbGlkQXR0YWNrKGNvb3JkcykpIHJldHVybjtcbiAgICBvcHBvbmVudEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRzKTtcbiAgICBpZiAoIW9wcG9uZW50Qm9hcmQuaXNTaGlwSGl0KGNvb3JkcykpIHRvZ2dsZUFjdGl2ZVBsYXllcigpO1xuICAgIHBsYXlHYW1lKCk7XG4gIH1cblxuICBjb25zdCBwbGF5R2FtZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAocGxheWVyMi5pc0FjdGl2ZSkge1xuICAgICAgYXdhaXQgc2xlZXAoMzAwKTtcbiAgICAgIHBsYXlUdXJuKEFJLmdldENvb3JkcyhvcHBvbmVudCgpLmdhbWVib2FyZC5nZXRCb2FyZCgpKSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICBpbml0UGxheWVyMSgpO1xuICAgIGluaXRQbGF5ZXIyKCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0LFxuICAgIHBsYXlUdXJuLFxuICB9O1xuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBHYW1lQ29udHJvbGxlcjsiLCJpbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSBcIi4vR2FtZUNvbnRyb2xsZXJcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4uL0ZhY3Rvcmllcy9QbGF5ZXJcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9GYWN0b3JpZXMvU2hpcFwiO1xuXG5jb25zdCBQbGFjZVNoaXBzID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyID0gUGxheWVyKCdzYW1wbGUnKTtcbiAgY29uc3Qgc2hpcHMgPSBbU2hpcCg0LCAnYWsnKSwgU2hpcCgyLCAnYicpLCBTaGlwKDUsICdjJyksIFNoaXAoNCwgJ2QnKSwgU2hpcCgyLCAnZScpXTtcbiAgbGV0IGN1cnJlbnQgPSB7XG4gICAgc2hpcE51bTogMCxcbiAgICBzaGlwQ29vcmRzQXJyYXk6IFtdLFxuICAgIGF4aXM6ICd4J1xuICB9O1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKVxuICBjb25zdCAkc2FtcGxlR2FtZUJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhbXBsZScpO1xuXG4gIC8vIFV0aWwgXG5cbiAgY29uc3QgZGVjb2RlQ29vcmRzID0gKGNvb3Jkc1N0cmluZykgPT4ge1xuICAgIGNvbnN0IGNvb3Jkc0FycmF5ID0gY29vcmRzU3RyaW5nLnNwbGl0KCcgJyk7XG4gICAgcmV0dXJuIHt4OiArY29vcmRzQXJyYXlbMF0sIHk6ICtjb29yZHNBcnJheVsxXX07XG4gIH1cblxuICBjb25zdCBjZWxsQXQgPSAoY29vcmRzKSA9PiB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWNvb3Jkcz1cIiR7Y29vcmRzLnh9ICR7Y29vcmRzLnl9XCJdYCk7XG4gIH1cblxuICAvLyBET01cblxuICBjb25zdCBuZXdDZWxsRE9NID0gKGNlbGwpID0+IHtcbiAgICBjb25zdCAkY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICRjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcbiAgICAkY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJywgYCR7Y2VsbC5jb29yZHMueH0gJHtjZWxsLmNvb3Jkcy55fWApO1xuICAgIGFkZENlbGxMaXN0ZW5lcigkY2VsbCk7XG4gICAgcmV0dXJuICRjZWxsO1xuICB9XG5cbiAgY29uc3QgYWRkQ2VsbExpc3RlbmVyID0gYXN5bmMgKCRjZWxsKSA9PiB7XG4gICAgJGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBwbGFjZVNoaXAoZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSksIGN1cnJlbnQuYXhpcyk7XG4gICAgICBQcm9taXNlLnJlc29sdmUoZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSkpO1xuICAgIH0pO1xuXG4gICAgJGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgc2hvd1NoaXAoZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSksIGN1cnJlbnQuYXhpcyk7XG4gICAgfSk7XG4gIH1cblxuXG5cbiAgY29uc3Qgc2hvd1NoaXAgPSAoY29vcmRzLCBheGlzKSA9PiB7XG4gICAgaWYgKGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QucmVtb3ZlKCd0ZW1wJyk7XG4gICAgICAgIGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5yZW1vdmUoJ2ludmFsaWQnKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5ID0gW107XG4gICAgbWFrZVNoaXAoY29vcmRzLCBheGlzKTtcbiAgICBpZiAoIWlzU2hpcFZhbGlkKCkpIHtcbiAgICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IHtcbiAgICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LmFkZChcImludmFsaWRcIik7XG4gICAgICB9KVxuICAgIH1cbiAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiB7XG4gICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QuYWRkKFwidGVtcFwiKTtcbiAgICB9KVxuICB9XG5cbiAgY29uc3QgbWFrZVNoaXAgPSAoY29vcmRzLCBheGlzKSA9PiB7XG4gICAgbGV0IG5ld0Nvb3JkcyA9IGNvb3JkcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBzW2N1cnJlbnQuc2hpcE51bV0uZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkucHVzaCh7eDogbmV3Q29vcmRzLngsIHk6IG5ld0Nvb3Jkcy55fSk7XG4gICAgICBheGlzID09PSAneCcgPyBuZXdDb29yZHMueCsrOiBuZXdDb29yZHMueSsrO1xuICAgICAgaWYgKG5ld0Nvb3Jkcy54ID4gOSB8fCBuZXdDb29yZHMueSA+IDkpIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGlzU2hpcFZhbGlkID0gKCkgPT4ge1xuICAgIHJldHVybiAoIXBsYXllci5nYW1lYm9hcmQuaXNDb2xsaXNpb25zKGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5KSAmJiBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5sZW5ndGggPT09IHNoaXBzW2N1cnJlbnQuc2hpcE51bV0uZ2V0TGVuZ3RoKCkpO1xuICB9XG5cbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKHBsYXllciwgcGxheWVyTmFtZSwgYm9hcmQpID0+IHtcbiAgICBsZXQgJGJvYXJkID0gJHNhbXBsZUdhbWVCb2FyZDtcbiAgICAkYm9hcmQuY2xhc3NMaXN0LmFkZChwbGF5ZXJOYW1lKTtcbiAgICBib2FyZC5mb3JFYWNoKGNlbGwgPT4gJGJvYXJkLmFwcGVuZENoaWxkKG5ld0NlbGxET00oY2VsbCkpKTtcbiAgfVxuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChjb29yZHMsIGF4aXMpID0+IHtcbiAgICBpZiAoIWlzU2hpcFZhbGlkKCkpIHJldHVybjtcbiAgICBwbGF5ZXIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbY3VycmVudC5zaGlwTnVtKytdLCBjb29yZHMsIGF4aXMpO1xuICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5LmZvckVhY2goY29vcmRzID0+IHtcbiAgICAgIGNvbnN0ICRjZWxsID0gY2VsbEF0KGNvb3Jkcyk7XG4gICAgICAkY2VsbC5jbGFzc0xpc3QuYWRkKCdzaGlwJyk7XG4gICAgICAkY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCd0ZW1wJyk7XG4gICAgfSlcbiAgICBpZiAoY3VycmVudC5zaGlwTnVtID09PSBzaGlwcy5sZW5ndGggLSAxKSB7XG4gICAgICAkbW9kYWwucmVtb3ZlKCk7XG4gICAgICBHYW1lQ29udHJvbGxlci5pbml0KCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgZ2V0U2FtcGxlUGxheWVyID0gKCkgPT4gcGxheWVyO1xuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkKCdzYW1wbGUnLCBwbGF5ZXIubmFtZSwgcGxheWVyLmdhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsICh7IGtleSB9KSA9PiB7XG4gICAgICBpZiAoa2V5ID09PSAnUicgfHwga2V5ID09PSAncicpIHtcbiAgICAgICAgY3VycmVudC5heGlzID0gY3VycmVudC5heGlzID09PSAneCcgPyAneSc6ICd4JztcbiAgICAgICAgc2hvd1NoaXAoY3VycmVudC5zaGlwQ29vcmRzQXJyYXlbMF0sIGN1cnJlbnQuYXhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgZ2V0U2FtcGxlUGxheWVyLFxuICB9XG5cbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFBsYWNlU2hpcHM7IiwiLy8gaW1wb3J0IEdhbWVDb250cm9sbGVyIGZyb20gXCIuL01vZHVsZXMvR2FtZUNvbnRyb2xsZXJcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL01vZHVsZXMvUGxhY2VTaGlwc1wiO1xuXG5QbGFjZVNoaXBzLmluaXQoKTsiXSwibmFtZXMiOlsiJHAxR2FtZWJvYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiJHAyR2FtZWJvYXJkIiwiaW5pdCIsImNsYXNzTGlzdCIsImFkZCIsInJlbmRlckdhbWVib2FyZCIsInBsYXllciIsInBsYXllck5hbWUiLCJib2FyZCIsIiRib2FyZCIsImZvckVhY2giLCJjZWxsIiwiYXBwZW5kQ2hpbGQiLCIkY2VsbCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjb29yZHMiLCJ4IiwieSIsImhhc1NoaXAiLCJhZGRFdmVudExpc3RlbmVyIiwiY29vcmRzQXJyYXkiLCJnZXRBdHRyaWJ1dGUiLCJzcGxpdCIsImFkZENlbGxMaXN0ZW5lciIsIm5ld0NlbGxET00iLCJjZWxsSGl0IiwiZW5jb2RlZENvb3JkcyIsInNoaXBTdW5rIiwidG9nZ2xlQWN0aXZlQm9hcmQiLCJ0b2dnbGUiLCJzaXplIiwic2hpcHMiLCJhcnIiLCJpIiwicHVzaCIsIk1hdGgiLCJmbG9vciIsImlzU2hvdCIsIl9tYWtlR3JpZCIsImF0IiwiaXNWYWxpZEF0dGFjayIsImlzU2hpcEhpdCIsInJlY2VpdmVBdHRhY2siLCJzaGlwIiwiZmluZCIsIm5hbWUiLCJoaXQiLCJpc1N1bmsiLCJzaGlwTmFtZSIsImNvbnNvbGUiLCJsb2ciLCJmaWx0ZXIiLCJtYXAiLCJzZXRTaGlwIiwiYXhpcyIsIm5ld0Nvb3JkcyIsImdldExlbmd0aCIsImlzQ29sbGlzaW9ucyIsInNoaXBDb29yZHNBcnJheSIsInNoaXBDb29yZHMiLCJnZXRCb2FyZCIsImdhbWVib2FyZCIsImlzQWN0aXZlIiwibGVuZ3RoIiwic2hpcExlbmd0aCIsImhpdENvdW50IiwiZ2V0SGl0cyIsInZhbGlkQ2VsbHMiLCJyYW5kb20iLCJwbGF5ZXIxIiwicGxheWVyMiIsIm9wcG9uZW50IiwicGxheVR1cm4iLCJvcHBvbmVudEJvYXJkIiwicGxheUdhbWUiLCJhc3luYyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImluaXRQbGF5ZXIyIiwiY3VycmVudCIsInNoaXBOdW0iLCIkbW9kYWwiLCIkc2FtcGxlR2FtZUJvYXJkIiwiZGVjb2RlQ29vcmRzIiwiY29vcmRzU3RyaW5nIiwiY2VsbEF0Iiwic2hvd1NoaXAiLCJyZW1vdmUiLCJtYWtlU2hpcCIsImlzU2hpcFZhbGlkIiwicGxhY2VTaGlwIiwia2V5IiwiZ2V0U2FtcGxlUGxheWVyIl0sInNvdXJjZVJvb3QiOiIifQ==