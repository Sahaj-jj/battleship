(()=>{"use strict";const e=e=>{let t=[],s=0;const a=(e=>{const t=[];for(let s=0;s<e*e;s++)t.push({coords:{x:s%e,y:Math.floor(s/e)},hasShip:"",isShot:!1});return t})(e),r=t=>a[t.x+t.y*e];return{at:r,isValidAttack:e=>!r(e).isShot,isShipHit:e=>""!==r(e).hasShip,receiveAttack:e=>{const a=r(e);a.isShot=!0,a.hasShip&&(e=>{const a=t.find((t=>t.name===e));a.hit(),a.isSunk()&&s++})(a.hasShip)},setShip:(e,s,a="x")=>{t.push(e);let i=s;for(let t=0;t<e.getLength();t++)r(i).hasShip=e.name,"x"===a?i.x++:i.y++},getShipCoordsArray:e=>a.filter((t=>t.hasShip===e.name)).map((e=>e.coords)),isCollisions:t=>{for(const a of t){if(a.x>e-1||a.y>e-1)return!0;if(""!==r(a).hasShip)return!0;const t=[{x:(s=a).x+1,y:s.y},{x:s.x-1,y:s.y},{x:s.x,y:s.y+1},{x:s.x,y:s.y-1}];for(const s of t)if(!(s.x>e-1||s.x<0||s.y>e-1||s.y<0)&&""!==r(s).hasShip)return!0}var s;return!1},getShipByCoords:e=>t.find((t=>t.name===r(e).hasShip)),getBoard:()=>a,getShips:()=>t,reset:()=>{t=[];for(const e of a)e.isShot=!1,e.hasShip=""},allShipsSunk:()=>s>=t.length}},t=(t,s)=>({name:t,displayName:s,gameboard:e(10),isActive:!1}),s=(()=>{const e=document.querySelector(".gameboards-container"),t=document.querySelector(".modal"),s=document.querySelector(".modal-win");let a="PLAY";const r=e=>{const t=e.split(" ");return{x:+t[0],y:+t[1]}},n=(e,t=null,s=null)=>{const a=document.createElement(e);return t&&t.forEach((e=>a.classList.add(e))),s&&(a.textContent=s),a};return{renderGameboard:(s,d,c=!1)=>{a="sample"===s?"PLACE":"PLAY";const h=(e=>{const t=n("div",["container"]);return t.appendChild(n("div",[`${e}`,"board"])),t.appendChild(n("div",["ships-display"])),t})(s);"PLACE"===a?t.appendChild(h):e.appendChild(h),c&&h.firstChild.classList.add("active"),d.forEach((e=>h.firstChild.appendChild((e=>{const t=n("div",["cell"]);return t.setAttribute("data-coords",`${e.coords.x} ${e.coords.y}`),e.hasShip&&t.classList.add("ship"),(e=>{"PLACE"===a?(e.addEventListener("click",(()=>{o.placeShip(r(e.getAttribute("data-coords")))})),e.addEventListener("mouseover",(()=>{o.showShip(r(e.getAttribute("data-coords")))}))):e.addEventListener("click",(()=>{i.playTurn(r(e.getAttribute("data-coords")))}))})(t),t})(e))))},updateShipsDisplay:(e,t,s=-1)=>{const r=document.querySelector(`.${e}`).nextElementSibling;r.textContent="",t.forEach(((e,t)=>{r.appendChild(((e,t=!1)=>{const s=n("div",["ship-container"]);(e.isSunk()||"PLACE"===a&&t)&&s.classList.add("sunk"),s.appendChild(n("div",["ship-name"],e.name));const r=n("div",["ship-body"]);for(let t=0;t<e.getLength();t++)r.appendChild(n("div",["ship-cell"]));return s.appendChild(r),s})(e,t<=s))}))},cellHit:e=>{console.log(e);const t=`${e.x} ${e.y}`;document.querySelector(`.active > [data-coords="${t}"]`).classList.add("hit")},shipSunk:e=>{e.forEach((e=>{document.querySelector(`.active > [data-coords="${e.x} ${e.y}"]`).classList.add("sunk")}))},toggleActiveBoard:()=>{Array.from(e.children).forEach((e=>{e.classList.contains("container")&&e.firstChild.classList.toggle("active")}))},showWinner:e=>{s.firstChild.textContent=`${e} wins`,s.classList.add("visible")}}})(),a=(e,t)=>{const s=e;let a=0;return{name:t,getLength:()=>s,getHits:()=>a,hit:()=>{a++},isSunk:()=>a>=s}},r=(()=>{const e=t("AI"),s=[a(5,"Carrier"),a(4,"Battleship"),a(3,"Cruiser"),a(3,"Submarine"),a(2,"Destroyer")];let r=null;const i=()=>{const t=e.gameboard.getBoard().filter((e=>!e.isShot));return t[Math.floor(Math.random()*t.length)].coords},o=(e,t,s=!1)=>Object.keys(e).reduce(((a,r)=>({...a,[r]:e[r]+(s?-1:1)*t[r]})),{});return{getCoords:t=>{let s;return e.gameboard=t,r?e.gameboard.getShips().find((t=>t.name===e.gameboard.at(r).hasShip)).isSunk()?(r=null,s=i()):s=(()=>{const t=function(e){let t=e.length;for(;t--;){const s=Math.floor(Math.random()*t);[e[t],e[s]]=[e[s],e[t]]}return e}((e=>{const t=[-1,1];let s=[];for(const a of t)for(const t in e){const r=e[t]+a;r<=9&&r>=0&&s.push({...e,[t]:r})}return s})(r));for(const s of t){let t=e.gameboard.at(s);if(t.isShot&&t.hasShip){let a={...s},i=o(a,r,!0);for(;t.isShot&&t.hasShip&&(a=o(a,i),!(a.x<0||a.x>9||a.y<0||a.y>9));)t=e.gameboard.at(a);return t.isShot?o(r,i,!0):a}}for(const s of t)if(!e.gameboard.at(s).isShot)return s})():s=i(),e.gameboard.isShipHit(s)&&(r=s),s},getAIPlayer:()=>(e.gameboard.setShip(s[0],{x:0,y:0},"x"),e.gameboard.setShip(s[1],{x:9,y:6},"y"),e.gameboard.setShip(s[2],{x:1,y:7},"y"),e.gameboard.setShip(s[3],{x:7,y:1},"x"),e.gameboard.setShip(s[4],{x:4,y:3},"x"),e)}})(),i=(()=>{const e=t("P1","Player"),a=t("P2","Enemy");function i(e){return new Promise((t=>setTimeout(t,e)))}const n=()=>e.isActive?a:e,d=async t=>{const r=n().gameboard;if(r.isValidAttack(t)){if(r.receiveAttack(t),s.cellHit(t),r.isShipHit(t)){s.updateShipsDisplay(n().name,r.getShips());const i=r.getShipByCoords(t);if(i.isSunk()&&(s.shipSunk(r.getShipCoordsArray(i)),r.allShipsSunk()))return void s.showWinner((e.isActive?e:a).displayName)}else await i(300),e.isActive=!e.isActive,a.isActive=!a.isActive,s.toggleActiveBoard();c()}},c=async()=>{a.isActive&&(await i(300*Math.random()+300),d(r.getCoords(n().gameboard)))};return{init:()=>{e.isActive=!0,e.gameboard=o.getSamplePlayer().gameboard,s.renderGameboard(e.name,e.gameboard.getBoard()),s.updateShipsDisplay(e.name,e.gameboard.getShips()),a.isActive=!1,a.gameboard=r.getAIPlayer().gameboard,s.renderGameboard(a.name,a.gameboard.getBoard(),!0),s.updateShipsDisplay(a.name,a.gameboard.getShips())},playTurn:d}})(),o=(()=>{const e=t("sample"),r=[a(5,"Carrier"),a(4,"Battleship"),a(3,"Cruiser"),a(3,"Submarine"),a(2,"Destroyer")];let o={shipNum:0,shipCoordsArray:[],axis:"x"};const n=document.querySelector(".modal"),d=document.querySelector("button.play"),c=document.querySelector("button.reset"),h=e=>document.querySelector(`[data-coords="${e.x} ${e.y}"]`),l=e=>{o.shipNum>=r.length||(0!==o.shipCoordsArray.length&&o.shipCoordsArray.forEach((e=>{h(e).classList.remove("temp"),h(e).classList.remove("invalid")})),o.shipCoordsArray=p(e),o.shipCoordsArray.forEach((e=>{h(e).classList.add("temp")})),m()||o.shipCoordsArray.forEach((e=>{h(e).classList.add("invalid")})))},p=e=>{let t=[],s=e;for(let e=0;e<r[o.shipNum].getLength()&&(t.push({x:s.x,y:s.y}),"x"===o.axis?s.x++:s.y++,!(s.x>9||s.y>9));e++);return t},m=()=>!e.gameboard.isCollisions(o.shipCoordsArray)&&o.shipCoordsArray.length===r[o.shipNum].getLength(),u=()=>{e.gameboard.reset(),e.gameboard.getBoard().forEach((e=>{h(e.coords).classList.remove("ship"),h(e.coords).classList.remove("temp"),h(e.coords).classList.remove("invalid")})),Array.from(document.querySelector(".ships-display").children).forEach((e=>e.classList.remove("sunk"))),o={shipNum:0,shipCoordsArray:[],axis:"x"},d.style.display="none"};return{init:()=>{s.renderGameboard(e.name,e.gameboard.getBoard()),s.updateShipsDisplay(e.name,r),document.addEventListener("keyup",(({key:e})=>{"R"!==e&&"r"!==e||(o.axis="x"===o.axis?"y":"x",l(o.shipCoordsArray[0],o.axis))})),d.addEventListener("click",(()=>{n.remove(),i.init()})),c.addEventListener("click",u)},placeShip:t=>{m()&&(e.gameboard.setShip(r[o.shipNum++],t,o.axis),o.shipCoordsArray.forEach((e=>{h(e).classList.add("ship"),h(e).classList.remove("temp")})),s.updateShipsDisplay(e.name,r,o.shipNum-1),o.shipNum===r.length&&(d.style.display="block"))},showShip:l,getSamplePlayer:()=>e}})();o.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cUYsT0FBTyxjQUVmdkQsTUFBTUMsS0FBS2hELFNBQVNDLGNBQWMsa0JBQWtCZ0QsVUFDNURsQyxTQUFRdUIsR0FBa0JBLEVBQWVyQixVQUFVcUYsT0FBTyxVQUMxRUwsRUFBVSxDQUNSaEUsUUFBUyxFQUNUOUMsZ0JBQWlCLEdBQ2pCUCxLQUFNLEtBRVJzSCxFQUFZTyxNQUFNQyxRQUFVLFFBd0I5QixNQUFPLENBQ0xYLEtBcEJXLEtBQ1gsa0JBQW1CQyxFQUFPekgsS0FBTXlILEVBQU9uRyxVQUFVTixZQUNqRCxxQkFBc0J5RyxFQUFPekgsS0FBTXRCLEdBRW5DK0MsU0FBUzRCLGlCQUFpQixTQUFTLEVBQUcyQyxJQUFBQSxNQUN4QixNQUFSQSxHQUF1QixNQUFSQSxJQUNqQjBCLEVBQVFySCxLQUF3QixNQUFqQnFILEVBQVFySCxLQUFlLElBQUssSUFDM0N5SCxFQUFTSixFQUFROUcsZ0JBQWdCLEdBQUk4RyxFQUFRckgsVUFJakRzSCxFQUFZdEUsaUJBQWlCLFNBQVMsS0FDcEMxQixFQUFPb0csU0FDUCxZQUdGSCxFQUFhdkUsaUJBQWlCLFFBQVNuQyxJQUt2Q2tILFVBckRpQnBKLElBQ1ppSixNQUNMUixFQUFPbkcsVUFBVWxCLFFBQVExQixFQUFNZ0osRUFBUWhFLFdBQVkxRSxFQUFRMEksRUFBUXJILE1BQ25FcUgsRUFBUTlHLGdCQUFnQjRCLFNBQVF4RCxJQUM5QjZJLEVBQU83SSxHQUFRMEQsVUFBVUMsSUFBSSxRQUM3QmtGLEVBQU83SSxHQUFRMEQsVUFBVXFGLE9BQU8sV0FFbEMscUJBQXNCTixFQUFPekgsS0FBTXRCLEVBQU9nSixFQUFRaEUsUUFBVSxHQUN4RGdFLEVBQVFoRSxVQUFZaEYsRUFBTTBDLFNBQzVCdUcsRUFBWU8sTUFBTUMsUUFBVSxXQTZDOUJMLFNBQUFBLEVBQ0FPLGdCQXpCc0IsSUFBTVosSUF0RmIsR0NGbkIsVSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yaWVzL0dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL0ZhY3Rvcmllcy9QbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvRmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9Nb2R1bGVzL0FJUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvTW9kdWxlcy9HYW1lQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL01vZHVsZXMvUGxhY2VTaGlwcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEdhbWVib2FyZCA9IChzaXplKSA9PiB7XG5cbiAgbGV0IHNoaXBzID0gW107XG4gIGxldCBzdW5rID0gMDtcblxuICBjb25zdCBjZWxsID0gKHgsIHkpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgY29vcmRzOiB7eCwgeX0sXG4gICAgICBoYXNTaGlwOiAnJyxcbiAgICAgIGlzU2hvdDogZmFsc2VcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgX21ha2VHcmlkID0gKHNpemUpID0+IHtcbiAgICBjb25zdCBhcnIgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemUgKiBzaXplOyBpKyspIHtcbiAgICAgIGFyci5wdXNoKGNlbGwoaSAlIHNpemUsIE1hdGguZmxvb3IoaSAvIHNpemUpKSk7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH1cblxuICBjb25zdCBib2FyZCA9IF9tYWtlR3JpZChzaXplKTtcbiAgY29uc3QgYXQgPSAoY29vcmRzKSA9PiBib2FyZFtjb29yZHMueCArIGNvb3Jkcy55ICogc2l6ZV07XG5cbiAgY29uc3QgaXNWYWxpZEF0dGFjayA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gIWF0KGNvb3JkcykuaXNTaG90O1xuICB9XG5cbiAgY29uc3Qgc2V0U2hpcCA9IChzaGlwLCBjb29yZHMsIGF4aXMgPSAneCcpID0+IHtcbiAgICBzaGlwcy5wdXNoKHNoaXApO1xuICAgIGxldCBuZXdDb29yZHMgPSBjb29yZHM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgIGF0KG5ld0Nvb3JkcykuaGFzU2hpcCA9IHNoaXAubmFtZTtcbiAgICAgIGF4aXMgPT09ICd4JyA/IG5ld0Nvb3Jkcy54Kys6IG5ld0Nvb3Jkcy55Kys7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaXNTaGlwSGl0ID0gKGNvb3JkcykgPT4ge1xuICAgIHJldHVybiBhdChjb29yZHMpLmhhc1NoaXAgIT09ICcnO1xuICB9XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZHMpID0+IHtcbiAgICBjb25zdCBjZWxsID0gYXQoY29vcmRzKTtcbiAgICBjZWxsLmlzU2hvdCA9IHRydWU7XG4gICAgaWYgKGNlbGwuaGFzU2hpcCkgc2hpcEhpdChjZWxsLmhhc1NoaXApO1xuICB9XG5cbiAgY29uc3Qgc2hpcEhpdCA9IChzaGlwTmFtZSkgPT4ge1xuICAgIGNvbnN0IHNoaXAgPSBzaGlwcy5maW5kKHNoaXAgPT4gc2hpcC5uYW1lID09PSBzaGlwTmFtZSk7XG4gICAgc2hpcC5oaXQoKTtcbiAgICBpZiAoc2hpcC5pc1N1bmsoKSkgc3VuaysrO1xuICB9XG5cbiAgY29uc3QgZ2V0U2hpcENvb3Jkc0FycmF5ID0gKHNoaXApID0+IHtcbiAgICByZXR1cm4gYm9hcmQuZmlsdGVyKGNlbGwgPT4gY2VsbC5oYXNTaGlwID09PSBzaGlwLm5hbWUpLm1hcChjZWxsID0+IGNlbGwuY29vcmRzKTtcbiAgfVxuXG4gIGNvbnN0IGlzQ29sbGlzaW9ucyA9IChzaGlwQ29vcmRzQXJyYXkpID0+IHtcbiAgICBmb3IgKGNvbnN0IHNoaXBDb29yZHMgb2Ygc2hpcENvb3Jkc0FycmF5KSB7XG4gICAgICBpZiAoc2hpcENvb3Jkcy54ID4gc2l6ZSAtIDEgfHwgc2hpcENvb3Jkcy55ID4gc2l6ZSAtIDEpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGF0KHNoaXBDb29yZHMpLmhhc1NoaXAgIT09ICcnKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGNvbnN0IGFkamFjZW50Q29vcmRzID0gZ2V0QWRqYWNlbnRDb29yZHNBcnJheShzaGlwQ29vcmRzKTtcbiAgICAgIGZvciAoY29uc3QgY29vcmRzIG9mIGFkamFjZW50Q29vcmRzKSB7XG4gICAgICAgIGlmIChjb29yZHMueCA+IHNpemUgLSAxIHx8IGNvb3Jkcy54IDwgMCB8fCBjb29yZHMueSA+IHNpemUgLSAxIHx8IGNvb3Jkcy55IDwgMCkgY29udGludWU7XG4gICAgICAgIGlmIChhdChjb29yZHMpLmhhc1NoaXAgIT09ICcnKSByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgZ2V0U2hpcEJ5Q29vcmRzID0gKGNvb3JkcykgPT4ge1xuICAgIHJldHVybiBzaGlwcy5maW5kKHNoaXAgPT4gc2hpcC5uYW1lID09PSBhdChjb29yZHMpLmhhc1NoaXApO1xuICB9XG5cbiAgY29uc3QgZ2V0QWRqYWNlbnRDb29yZHNBcnJheSA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gW1xuICAgICAge3g6IGNvb3Jkcy54ICsgMSwgeTogY29vcmRzLnl9LFxuICAgICAge3g6IGNvb3Jkcy54IC0gMSwgeTogY29vcmRzLnl9LFxuICAgICAge3g6IGNvb3Jkcy54LCB5OiBjb29yZHMueSArIDF9LFxuICAgICAge3g6IGNvb3Jkcy54LCB5OiBjb29yZHMueSAtIDF9XG4gICAgXTtcbiAgfVxuXG4gIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgIHNoaXBzID0gW107XG4gICAgZm9yIChjb25zdCBjZWxsIG9mIGJvYXJkKSB7XG4gICAgICBjZWxsLmlzU2hvdCA9IGZhbHNlO1xuICAgICAgY2VsbC5oYXNTaGlwID0gJyc7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBzdW5rID49IHNoaXBzLmxlbmd0aDtcbiAgfVxuXG4gIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmQ7XG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4gc2hpcHM7XG5cbiAgcmV0dXJuIHtcbiAgICBhdCxcbiAgICBpc1ZhbGlkQXR0YWNrLFxuICAgIGlzU2hpcEhpdCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIHNldFNoaXAsXG4gICAgZ2V0U2hpcENvb3Jkc0FycmF5LFxuICAgIGlzQ29sbGlzaW9ucyxcbiAgICBnZXRTaGlwQnlDb29yZHMsXG4gICAgZ2V0Qm9hcmQsXG4gICAgZ2V0U2hpcHMsXG4gICAgcmVzZXQsXG4gICAgYWxsU2hpcHNTdW5rXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDsiLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiXG5cbmNvbnN0IFBsYXllciA9IChuYW1lLCBkaXNwbGF5TmFtZSkgPT4ge1xuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZGlzcGxheU5hbWUsXG4gICAgZ2FtZWJvYXJkOiBHYW1lYm9hcmQoMTApLFxuICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyOyIsImltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9HYW1lQ29udHJvbGxlclwiO1xuaW1wb3J0IFBsYWNlU2hpcHMgZnJvbSBcIi4vUGxhY2VTaGlwc1wiO1xuXG5jb25zdCBVSSA9ICgoKSA9PiB7XG4gIGNvbnN0ICRnYW1lYm9hcmRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVib2FyZHMtY29udGFpbmVyJyk7XG4gIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICBjb25zdCAkd2luTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtd2luJyk7XG4gIGxldCBtb2RlID0gJ1BMQVknO1xuXG4gIGNvbnN0IGRlY29kZUNvb3JkcyA9IChjb29yZHNTdHJpbmcpID0+IHtcbiAgICBjb25zdCBjb29yZHNBcnJheSA9IGNvb3Jkc1N0cmluZy5zcGxpdCgnICcpO1xuICAgIHJldHVybiB7eDogK2Nvb3Jkc0FycmF5WzBdLCB5OiArY29vcmRzQXJyYXlbMV19O1xuICB9XG5cbiAgY29uc3QgY3JlYXRlSHRtbEVsZW1lbnQgPSAodHlwZSwgY2xhc3NBcnJheSA9IG51bGwsIHRleHQgPSBudWxsKSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7XG4gICAgaWYgKGNsYXNzQXJyYXkpIGNsYXNzQXJyYXkuZm9yRWFjaChjbHMgPT4gZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNscykpO1xuICAgIGlmICh0ZXh0KSBlbGVtZW50LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuICBcbiAgY29uc3QgbmV3Q2VsbERPTSA9IChjZWxsKSA9PiB7XG4gICAgICBjb25zdCAkY2VsbCA9IGNyZWF0ZUh0bWxFbGVtZW50KCdkaXYnLCBbJ2NlbGwnXSk7XG4gICAgICAkY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJywgYCR7Y2VsbC5jb29yZHMueH0gJHtjZWxsLmNvb3Jkcy55fWApO1xuICAgICAgaWYgKGNlbGwuaGFzU2hpcCkgJGNlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcCcpO1xuICAgICAgYWRkQ2VsbExpc3RlbmVyKCRjZWxsKTtcbiAgICAgIHJldHVybiAkY2VsbDtcbiAgfVxuXG4gIGNvbnN0IGFkZENlbGxMaXN0ZW5lciA9ICgkY2VsbCkgPT4ge1xuICAgIGlmIChtb2RlID09PSAnUExBQ0UnKSB7XG4gICAgICAkY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgUGxhY2VTaGlwcy5wbGFjZVNoaXAoZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSkpO1xuICAgICAgfSk7XG4gIFxuICAgICAgJGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgICBQbGFjZVNoaXBzLnNob3dTaGlwKGRlY29kZUNvb3JkcygkY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29vcmRzJykpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlICRjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgR2FtZUNvbnRyb2xsZXIucGxheVR1cm4oZGVjb2RlQ29vcmRzKCRjZWxsLmdldEF0dHJpYnV0ZSgnZGF0YS1jb29yZHMnKSkpO1xuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgY2VsbEhpdCA9IChjb29yZHMpID0+IHtcbiAgICBjb25zb2xlLmxvZyhjb29yZHMpO1xuICAgIGNvbnN0IGVuY29kZWRDb29yZHMgPSBgJHtjb29yZHMueH0gJHtjb29yZHMueX1gO1xuICAgIGNvbnN0ICRjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmFjdGl2ZSA+IFtkYXRhLWNvb3Jkcz1cIiR7ZW5jb2RlZENvb3Jkc31cIl1gKTtcbiAgICAkY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKTtcbiAgfVxuXG4gIGNvbnN0IHRvZ2dsZUFjdGl2ZUJvYXJkID0gKCkgPT4ge1xuICAgIGNvbnN0ICRnYW1lYm9hcmRDb250YWluZXJzID0gQXJyYXkuZnJvbSgkZ2FtZWJvYXJkc0NvbnRhaW5lci5jaGlsZHJlbik7XG4gICAgJGdhbWVib2FyZENvbnRhaW5lcnMuZm9yRWFjaCgkZ2FtZWJvYXJkQ29udGFpbmVyID0+IHtcbiAgICAgIGlmICgkZ2FtZWJvYXJkQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnY29udGFpbmVyJykpXG4gICAgICAgICRnYW1lYm9hcmRDb250YWluZXIuZmlyc3RDaGlsZC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHNoaXBTdW5rID0gKGNvb3Jkc0FycmF5KSA9PiB7XG4gICAgY29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmFjdGl2ZSA+IFtkYXRhLWNvb3Jkcz1cIiR7Y29vcmRzLnh9ICR7Y29vcmRzLnl9XCJdYCkuY2xhc3NMaXN0LmFkZCgnc3VuaycpO1xuICAgIH0pXG4gIH1cblxuICBjb25zdCBuZXdHYW1lYm9hcmRDb250YWluZXJET00gPSAocGxheWVyTmFtZSkgPT4ge1xuICAgIGNvbnN0ICRjb250YWluZXIgPSBjcmVhdGVIdG1sRWxlbWVudCgnZGl2JywgWydjb250YWluZXInXSk7XG4gICAgJGNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVIdG1sRWxlbWVudCgnZGl2JywgW2Ake3BsYXllck5hbWV9YCwgJ2JvYXJkJ10pKTtcbiAgICAkY29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUh0bWxFbGVtZW50KCdkaXYnLCBbJ3NoaXBzLWRpc3BsYXknXSkpO1xuICAgIHJldHVybiAkY29udGFpbmVyO1xuICB9XG5cbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKHBsYXllck5hbWUsIGJvYXJkLCBpc0FjdGl2ZSA9IGZhbHNlKSA9PiB7XG4gICAgbW9kZSA9IHBsYXllck5hbWUgPT09ICdzYW1wbGUnID8gJ1BMQUNFJzogJ1BMQVknO1xuICAgIGNvbnN0ICRjb250YWluZXIgPSBuZXdHYW1lYm9hcmRDb250YWluZXJET00ocGxheWVyTmFtZSk7XG4gICAgbW9kZSA9PT0gJ1BMQUNFJyA/ICRtb2RhbC5hcHBlbmRDaGlsZCgkY29udGFpbmVyKTogJGdhbWVib2FyZHNDb250YWluZXIuYXBwZW5kQ2hpbGQoJGNvbnRhaW5lcik7XG4gICAgaWYgKGlzQWN0aXZlKSAkY29udGFpbmVyLmZpcnN0Q2hpbGQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgYm9hcmQuZm9yRWFjaChjZWxsID0+ICRjb250YWluZXIuZmlyc3RDaGlsZC5hcHBlbmRDaGlsZChuZXdDZWxsRE9NKGNlbGwpKSk7XG4gIH1cblxuICBjb25zdCBuZXdTaGlwRE9NID0gKHNoaXAsIGlzUGxhY2VkID0gZmFsc2UpID0+IHtcbiAgICBjb25zdCAkc2hpcENvbnRhaW5lciA9IGNyZWF0ZUh0bWxFbGVtZW50KCdkaXYnLCBbJ3NoaXAtY29udGFpbmVyJ10pO1xuICAgIGlmIChzaGlwLmlzU3VuaygpIHx8IChtb2RlID09PSAnUExBQ0UnICYmIGlzUGxhY2VkKSkgJHNoaXBDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc3VuaycpO1xuICAgICRzaGlwQ29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUh0bWxFbGVtZW50KCdkaXYnLCBbJ3NoaXAtbmFtZSddLCBzaGlwLm5hbWUpKTtcbiAgICBjb25zdCAkc2hpcEJvZHkgPSBjcmVhdGVIdG1sRWxlbWVudCgnZGl2JywgWydzaGlwLWJvZHknXSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICRzaGlwQm9keS5hcHBlbmRDaGlsZChjcmVhdGVIdG1sRWxlbWVudCgnZGl2JywgWydzaGlwLWNlbGwnXSkpO1xuICAgIH1cbiAgICAkc2hpcENvbnRhaW5lci5hcHBlbmRDaGlsZCgkc2hpcEJvZHkpO1xuICAgIHJldHVybiAkc2hpcENvbnRhaW5lcjtcbiAgfVxuXG4gIGNvbnN0IHVwZGF0ZVNoaXBzRGlzcGxheSA9IChwbGF5ZXJOYW1lLCBzaGlwcywgc2hpcE51bSA9IC0xKSA9PiB7XG4gICAgY29uc3QgJHNoaXBzRGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3BsYXllck5hbWV9YCkubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICRzaGlwc0Rpc3BsYXkudGV4dENvbnRlbnQgPSAnJztcbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwLCBpbmRleCkgPT4ge1xuICAgICAgJHNoaXBzRGlzcGxheS5hcHBlbmRDaGlsZChuZXdTaGlwRE9NKHNoaXAsIGluZGV4IDw9IHNoaXBOdW0pKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHNob3dXaW5uZXIgPSAocGxheWVyRGlzcGxheU5hbWUpID0+IHtcbiAgICAkd2luTW9kYWwuZmlyc3RDaGlsZC50ZXh0Q29udGVudCA9IGAke3BsYXllckRpc3BsYXlOYW1lfSB3aW5zYDtcbiAgICAkd2luTW9kYWwuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJHYW1lYm9hcmQsXG4gICAgdXBkYXRlU2hpcHNEaXNwbGF5LFxuICAgIGNlbGxIaXQsXG4gICAgc2hpcFN1bmssXG4gICAgdG9nZ2xlQWN0aXZlQm9hcmQsXG4gICAgc2hvd1dpbm5lcixcbiAgfTtcblxufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgVUk7IiwiY29uc3QgU2hpcCA9IChsZW5ndGgsIG5hbWUpID0+IHtcbiAgY29uc3Qgc2hpcExlbmd0aCA9IGxlbmd0aDtcbiAgbGV0IGhpdENvdW50ID0gMDtcblxuICAvLyBHZXR0ZXJzXG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHNoaXBMZW5ndGg7XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiBoaXRDb3VudDtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0Q291bnQrKztcbiAgfVxuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gaGl0Q291bnQgPj0gc2hpcExlbmd0aDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBnZXRMZW5ndGgsXG4gICAgZ2V0SGl0cyxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBTaGlwOyIsImltcG9ydCBQbGF5ZXIgZnJvbSBcIi4uL0ZhY3Rvcmllcy9QbGF5ZXJcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuLi9GYWN0b3JpZXMvU2hpcFwiO1xuXG5jb25zdCBBSSA9ICgoKSA9PiB7XG5cbiAgY29uc3QgQUlwbGF5ZXIgPSBQbGF5ZXIoJ0FJJyk7XG4gIGNvbnN0IHNoaXBzID0gW1NoaXAoNSwgJ0NhcnJpZXInKSwgU2hpcCg0LCAnQmF0dGxlc2hpcCcpLCBTaGlwKDMsICdDcnVpc2VyJyksIFNoaXAoMywgJ1N1Ym1hcmluZScpLCBTaGlwKDIsICdEZXN0cm95ZXInKV07XG4gIGxldCBwcmV2U2hpcEhpdCA9IG51bGw7XG5cbiAgY29uc3QgcGxhY2VTaGlwcyA9ICgpID0+IHtcbiAgICBBSXBsYXllci5nYW1lYm9hcmQuc2V0U2hpcChzaGlwc1swXSwgeyB4OiAwLCB5OiAwIH0sICd4Jyk7XG4gICAgQUlwbGF5ZXIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbMV0sIHsgeDogOSwgeTogNiB9LCAneScpO1xuICAgIEFJcGxheWVyLmdhbWVib2FyZC5zZXRTaGlwKHNoaXBzWzJdLCB7IHg6IDEsIHk6IDcgfSwgJ3knKTtcbiAgICBBSXBsYXllci5nYW1lYm9hcmQuc2V0U2hpcChzaGlwc1szXSwgeyB4OiA3LCB5OiAxIH0sICd4Jyk7XG4gICAgQUlwbGF5ZXIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbNF0sIHsgeDogNCwgeTogMyB9LCAneCcpO1xuICB9XG5cbiAgY29uc3QgZ2V0UmFuZG9tVmFsaWRDb29yZHMgPSAoKSA9PiB7XG4gICAgY29uc3QgYm9hcmQgPSBBSXBsYXllci5nYW1lYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCB2YWxpZENlbGxzID0gYm9hcmQuZmlsdGVyKGNlbGwgPT4gIWNlbGwuaXNTaG90KTtcbiAgICBjb25zdCBjb29yZHMgPSB2YWxpZENlbGxzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkQ2VsbHMubGVuZ3RoKV0uY29vcmRzO1xuICAgIHJldHVybiBjb29yZHM7XG4gIH1cblxuICBjb25zdCBnZXRWYWxpZEFkamFjZW50Q29vcmRzID0gKGNvb3JkcykgPT4ge1xuICAgIGNvbnN0IGFkamFjZW5jeSA9IFstMSwgMV07IC8vIDQtd2F5IGFkamFjZW5jeVxuICAgIGxldCBhZGphY2VudENvb3JkcyA9IFtdO1xuICAgIGZvcihjb25zdCBhZGphY2VudCBvZiBhZGphY2VuY3kpIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIGNvb3Jkcykge1xuICAgICAgICBjb25zdCBuZXdQb2ludCA9IGNvb3Jkc1trZXldICsgYWRqYWNlbnQ7XG4gICAgICAgIGlmIChuZXdQb2ludCA8PSA5ICYmIG5ld1BvaW50ID49IDApe1xuICAgICAgICAgIGFkamFjZW50Q29vcmRzLnB1c2goey4uLmNvb3JkcywgW2tleV06IG5ld1BvaW50fSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGFkamFjZW50Q29vcmRzO1xuICB9XG5cbiAgZnVuY3Rpb24gc2h1ZmZsZUZpc2hlcllhdGVzKGFycmF5KSB7XG4gICAgbGV0IGkgPSBhcnJheS5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgY29uc3QgcmkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpKTtcbiAgICAgIFthcnJheVtpXSwgYXJyYXlbcmldXSA9IFthcnJheVtyaV0sIGFycmF5W2ldXTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgY29uc3Qgc3VtID0gKG9iajEsIG9iajIsIHN1YnRyYWN0ID0gZmFsc2UpID0+IHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqMSkucmVkdWNlKChhY2N1bXVsYXRvciwga2V5KSA9PiBcbiAgICAgICAgICAoey4uLmFjY3VtdWxhdG9yLCBba2V5XTogb2JqMVtrZXldICsgKHN1YnRyYWN0ID8gLTE6IDEpICogb2JqMltrZXldfSksIFxuICAgICAgICAgIHt9KTtcbiAgfVxuXG4gIGNvbnN0IHRyYWNlTGFzdFNoaXBIaXQgPSAoKSA9PiB7XG4gICAgY29uc3QgYWRqYWNlbnRDb29yZHMgPSBzaHVmZmxlRmlzaGVyWWF0ZXMoZ2V0VmFsaWRBZGphY2VudENvb3JkcyhwcmV2U2hpcEhpdCkpO1xuICAgIGZvciAoY29uc3QgY29vcmRzIG9mIGFkamFjZW50Q29vcmRzKSB7XG4gICAgICBsZXQgY2VsbCA9IEFJcGxheWVyLmdhbWVib2FyZC5hdChjb29yZHMpO1xuICAgICAgaWYgKGNlbGwuaXNTaG90ICYmIGNlbGwuaGFzU2hpcCkge1xuICAgICAgICBsZXQgbmV3Q29vcmRzID0gey4uLmNvb3Jkc307XG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSBzdW0obmV3Q29vcmRzLCBwcmV2U2hpcEhpdCwgdHJ1ZSk7XG4gICAgICAgIHdoaWxlIChjZWxsLmlzU2hvdCAmJiBjZWxsLmhhc1NoaXApIHtcbiAgICAgICAgICBuZXdDb29yZHMgPSBzdW0obmV3Q29vcmRzLCBkaXJlY3Rpb24pO1xuICAgICAgICAgIGlmIChuZXdDb29yZHMueCA8IDAgfHwgbmV3Q29vcmRzLnggPiA5IHx8IG5ld0Nvb3Jkcy55IDwgMCB8fCBuZXdDb29yZHMueSA+IDkpIGJyZWFrO1xuICAgICAgICAgIGNlbGwgPSBBSXBsYXllci5nYW1lYm9hcmQuYXQobmV3Q29vcmRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbC5pc1Nob3QpIHtcbiAgICAgICAgICByZXR1cm4gc3VtKHByZXZTaGlwSGl0LCBkaXJlY3Rpb24sIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdDb29yZHM7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAoY29uc3QgY29vcmRzIG9mIGFkamFjZW50Q29vcmRzKSB7XG4gICAgICBsZXQgY2VsbCA9IEFJcGxheWVyLmdhbWVib2FyZC5hdChjb29yZHMpO1xuICAgICAgaWYgKGNlbGwuaXNTaG90KSBjb250aW51ZTtcbiAgICAgIGVsc2UgcmV0dXJuIGNvb3JkcztcbiAgICB9XG4gIH1cblxuICBjb25zdCBnZXRDb29yZHMgPSAoZ2FtZWJvYXJkKSA9PiB7XG4gICAgbGV0IGNvb3JkcztcbiAgICBBSXBsYXllci5nYW1lYm9hcmQgPSBnYW1lYm9hcmQ7XG4gICAgaWYgKHByZXZTaGlwSGl0KSB7XG4gICAgICAvLyBpZiBwcmV2IGhpdCBzdW5rIGEgc2hpcCB0aGVuIHJlc2V0XG4gICAgICBpZiAoQUlwbGF5ZXIuZ2FtZWJvYXJkXG4gICAgICAuZ2V0U2hpcHMoKVxuICAgICAgLmZpbmQoc2hpcCA9PiBzaGlwLm5hbWUgPT09IEFJcGxheWVyLmdhbWVib2FyZC5hdChwcmV2U2hpcEhpdCkuaGFzU2hpcClcbiAgICAgIC5pc1N1bmsoKSkge1xuICAgICAgICBwcmV2U2hpcEhpdCA9IG51bGw7XG4gICAgICAgIGNvb3JkcyA9IGdldFJhbmRvbVZhbGlkQ29vcmRzKCk7XG4gICAgICB9IGVsc2UgY29vcmRzID0gdHJhY2VMYXN0U2hpcEhpdCgpO1xuICAgIH0gZWxzZSBjb29yZHMgPSBnZXRSYW5kb21WYWxpZENvb3JkcygpO1xuICAgIGlmIChBSXBsYXllci5nYW1lYm9hcmQuaXNTaGlwSGl0KGNvb3JkcykpIHByZXZTaGlwSGl0ID0gY29vcmRzO1xuICAgIHJldHVybiBjb29yZHM7XG4gIH07XG5cbiAgY29uc3QgZ2V0QUlQbGF5ZXIgPSAoKSA9PiB7XG4gICAgcGxhY2VTaGlwcygpO1xuICAgIHJldHVybiBBSXBsYXllcjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZ2V0Q29vcmRzLFxuICAgIGdldEFJUGxheWVyLFxuICB9O1xuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBBSTsiLCJpbXBvcnQgUGxheWVyIGZyb20gXCIuLi9GYWN0b3JpZXMvUGxheWVyXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcbmltcG9ydCBQbGFjZVNoaXBzIGZyb20gXCIuL1BsYWNlU2hpcHNcIjtcbmltcG9ydCBBSSBmcm9tIFwiLi9BSVBsYXllclwiO1xuXG5jb25zdCBHYW1lQ29udHJvbGxlciA9ICgoKSA9PiB7XG5cbiAgY29uc3QgcGxheWVyMSA9IFBsYXllcignUDEnLCAnUGxheWVyJyk7XG4gIGNvbnN0IHBsYXllcjIgPSBQbGF5ZXIoJ1AyJywgJ0VuZW15Jyk7XG5cbiAgZnVuY3Rpb24gc2xlZXAobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG4gIH0gXG5cbiAgY29uc3Qgb3Bwb25lbnQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBsYXllcjEuaXNBY3RpdmUgPyBwbGF5ZXIyOiBwbGF5ZXIxO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlUGxheWVyID0gKCkgPT4ge1xuICAgIHJldHVybiBwbGF5ZXIxLmlzQWN0aXZlID8gcGxheWVyMTogcGxheWVyMjtcbiAgfVxuXG4gIGNvbnN0IHRvZ2dsZUFjdGl2ZVBsYXllciA9ICgpID0+IHtcbiAgICBwbGF5ZXIxLmlzQWN0aXZlID0gIXBsYXllcjEuaXNBY3RpdmU7XG4gICAgcGxheWVyMi5pc0FjdGl2ZSA9ICFwbGF5ZXIyLmlzQWN0aXZlO1xuICAgIFVJLnRvZ2dsZUFjdGl2ZUJvYXJkKCk7XG4gIH1cblxuICBjb25zdCBpbml0UGxheWVyMSA9ICgpID0+IHtcbiAgICBwbGF5ZXIxLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICBwbGF5ZXIxLmdhbWVib2FyZCA9IFBsYWNlU2hpcHMuZ2V0U2FtcGxlUGxheWVyKCkuZ2FtZWJvYXJkO1xuICAgIFVJLnJlbmRlckdhbWVib2FyZChwbGF5ZXIxLm5hbWUsIHBsYXllcjEuZ2FtZWJvYXJkLmdldEJvYXJkKCkpO1xuICAgIFVJLnVwZGF0ZVNoaXBzRGlzcGxheShwbGF5ZXIxLm5hbWUsIHBsYXllcjEuZ2FtZWJvYXJkLmdldFNoaXBzKCkpO1xuICB9XG5cbiAgY29uc3QgaW5pdFBsYXllcjIgPSAoKSA9PiB7XG4gICAgcGxheWVyMi5pc0FjdGl2ZSA9IGZhbHNlO1xuICAgIHBsYXllcjIuZ2FtZWJvYXJkID0gQUkuZ2V0QUlQbGF5ZXIoKS5nYW1lYm9hcmQ7XG4gICAgVUkucmVuZGVyR2FtZWJvYXJkKHBsYXllcjIubmFtZSwgcGxheWVyMi5nYW1lYm9hcmQuZ2V0Qm9hcmQoKSwgdHJ1ZSk7XG4gICAgVUkudXBkYXRlU2hpcHNEaXNwbGF5KHBsYXllcjIubmFtZSwgcGxheWVyMi5nYW1lYm9hcmQuZ2V0U2hpcHMoKSk7XG5cbiAgfVxuXG4gIGNvbnN0IHBsYXlUdXJuID0gYXN5bmMgKGNvb3JkcykgPT4ge1xuICAgIGNvbnN0IG9wcG9uZW50Qm9hcmQgPSBvcHBvbmVudCgpLmdhbWVib2FyZDtcbiAgICBpZiAoIW9wcG9uZW50Qm9hcmQuaXNWYWxpZEF0dGFjayhjb29yZHMpKSByZXR1cm47XG5cbiAgICBvcHBvbmVudEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRzKTtcbiAgICBVSS5jZWxsSGl0KGNvb3Jkcyk7XG4gICAgXG4gICAgaWYgKCFvcHBvbmVudEJvYXJkLmlzU2hpcEhpdChjb29yZHMpKSB7XG4gICAgICBhd2FpdCBzbGVlcCgzMDApO1xuICAgICAgdG9nZ2xlQWN0aXZlUGxheWVyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFVJLnVwZGF0ZVNoaXBzRGlzcGxheShvcHBvbmVudCgpLm5hbWUsIG9wcG9uZW50Qm9hcmQuZ2V0U2hpcHMoKSk7XG4gICAgICBjb25zdCBzaGlwID0gb3Bwb25lbnRCb2FyZC5nZXRTaGlwQnlDb29yZHMoY29vcmRzKTtcbiAgICAgIGlmKHNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgVUkuc2hpcFN1bmsob3Bwb25lbnRCb2FyZC5nZXRTaGlwQ29vcmRzQXJyYXkoc2hpcCkpO1xuICAgICAgICBpZiAob3Bwb25lbnRCb2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgIFVJLnNob3dXaW5uZXIoYWN0aXZlUGxheWVyKCkuZGlzcGxheU5hbWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBwbGF5R2FtZSgpO1xuICB9XG5cbiAgY29uc3QgcGxheUdhbWUgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKHBsYXllcjIuaXNBY3RpdmUpIHtcbiAgICAgIGF3YWl0IHNsZWVwKE1hdGgucmFuZG9tKCkqMzAwICsgMzAwKTtcbiAgICAgIHBsYXlUdXJuKEFJLmdldENvb3JkcyhvcHBvbmVudCgpLmdhbWVib2FyZCkpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgaW5pdFBsYXllcjEoKTtcbiAgICBpbml0UGxheWVyMigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgICBwbGF5VHVybixcbiAgfTtcblxufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZUNvbnRyb2xsZXI7IiwiaW1wb3J0IEdhbWVDb250cm9sbGVyIGZyb20gXCIuL0dhbWVDb250cm9sbGVyXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuLi9GYWN0b3JpZXMvUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi4vRmFjdG9yaWVzL1NoaXBcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9VSVwiO1xuXG5jb25zdCBQbGFjZVNoaXBzID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyID0gUGxheWVyKCdzYW1wbGUnKTtcbiAgY29uc3Qgc2hpcHMgPSBbU2hpcCg1LCAnQ2FycmllcicpLCBTaGlwKDQsICdCYXR0bGVzaGlwJyksIFNoaXAoMywgJ0NydWlzZXInKSwgU2hpcCgzLCAnU3VibWFyaW5lJyksIFNoaXAoMiwgJ0Rlc3Ryb3llcicpXTtcbiAgbGV0IGN1cnJlbnQgPSB7XG4gICAgc2hpcE51bTogMCxcbiAgICBzaGlwQ29vcmRzQXJyYXk6IFtdLFxuICAgIGF4aXM6ICd4J1xuICB9O1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgY29uc3QgJHBsYXlCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdidXR0b24ucGxheScpO1xuICBjb25zdCAkcmVzZXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdidXR0b24ucmVzZXQnKTtcblxuICAvLyBVdGlsIFxuXG4gIGNvbnN0IGNlbGxBdCA9IChjb29yZHMpID0+IHtcbiAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtY29vcmRzPVwiJHtjb29yZHMueH0gJHtjb29yZHMueX1cIl1gKTtcbiAgfVxuXG4gIC8vIERPTVxuXG4gIGNvbnN0IHNob3dTaGlwID0gKGNvb3JkcykgPT4ge1xuICAgIGlmIChjdXJyZW50LnNoaXBOdW0gPj0gc2hpcHMubGVuZ3RoKSByZXR1cm47XG4gICAgaWYgKGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QucmVtb3ZlKCd0ZW1wJyk7XG4gICAgICAgIGNlbGxBdChjb29yZHMpLmNsYXNzTGlzdC5yZW1vdmUoJ2ludmFsaWQnKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5ID0gbWFrZVNoaXAoY29vcmRzKTtcbiAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5mb3JFYWNoKGNvb3JkcyA9PiB7XG4gICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QuYWRkKFwidGVtcFwiKTtcbiAgICB9KVxuICAgIGlmICghaXNTaGlwVmFsaWQoKSkge1xuICAgICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgICBjZWxsQXQoY29vcmRzKS5jbGFzc0xpc3QuYWRkKFwiaW52YWxpZFwiKTtcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgY29uc3QgbWFrZVNoaXAgPSAoY29vcmRzKSA9PiB7XG4gICAgbGV0IHNoaXBDb29yZHNBcnJheSA9IFtdO1xuICAgIGxldCBuZXdDb29yZHMgPSBjb29yZHM7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwc1tjdXJyZW50LnNoaXBOdW1dLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgIHNoaXBDb29yZHNBcnJheS5wdXNoKHt4OiBuZXdDb29yZHMueCwgeTogbmV3Q29vcmRzLnl9KTtcbiAgICAgIGN1cnJlbnQuYXhpcyA9PT0gJ3gnID8gbmV3Q29vcmRzLngrKzogbmV3Q29vcmRzLnkrKztcbiAgICAgIGlmIChuZXdDb29yZHMueCA+IDkgfHwgbmV3Q29vcmRzLnkgPiA5KSBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHNoaXBDb29yZHNBcnJheTtcbiAgfVxuXG4gIGNvbnN0IGlzU2hpcFZhbGlkID0gKCkgPT4ge1xuICAgIHJldHVybiAoIXBsYXllci5nYW1lYm9hcmQuaXNDb2xsaXNpb25zKGN1cnJlbnQuc2hpcENvb3Jkc0FycmF5KSAmJiBcbiAgICAgICAgICBjdXJyZW50LnNoaXBDb29yZHNBcnJheS5sZW5ndGggPT09IHNoaXBzW2N1cnJlbnQuc2hpcE51bV0uZ2V0TGVuZ3RoKCkpO1xuICB9XG5cbiAgXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChjb29yZHMpID0+IHtcbiAgICBpZiAoIWlzU2hpcFZhbGlkKCkpIHJldHVybjtcbiAgICBwbGF5ZXIuZ2FtZWJvYXJkLnNldFNoaXAoc2hpcHNbY3VycmVudC5zaGlwTnVtKytdLCBjb29yZHMsIGN1cnJlbnQuYXhpcyk7XG4gICAgY3VycmVudC5zaGlwQ29vcmRzQXJyYXkuZm9yRWFjaChjb29yZHMgPT4ge1xuICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LmFkZCgnc2hpcCcpO1xuICAgICAgY2VsbEF0KGNvb3JkcykuY2xhc3NMaXN0LnJlbW92ZSgndGVtcCcpO1xuICAgIH0pO1xuICAgIFVJLnVwZGF0ZVNoaXBzRGlzcGxheShwbGF5ZXIubmFtZSwgc2hpcHMsIGN1cnJlbnQuc2hpcE51bSAtIDEpO1xuICAgIGlmIChjdXJyZW50LnNoaXBOdW0gPT09IHNoaXBzLmxlbmd0aCkge1xuICAgICAgJHBsYXlCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgcGxheWVyLmdhbWVib2FyZC5yZXNldCgpO1xuICAgIHBsYXllci5nYW1lYm9hcmQuZ2V0Qm9hcmQoKS5mb3JFYWNoKGNlbGwgPT4ge1xuICAgICAgY2VsbEF0KGNlbGwuY29vcmRzKS5jbGFzc0xpc3QucmVtb3ZlKCdzaGlwJyk7XG4gICAgICBjZWxsQXQoY2VsbC5jb29yZHMpLmNsYXNzTGlzdC5yZW1vdmUoJ3RlbXAnKTtcbiAgICAgIGNlbGxBdChjZWxsLmNvb3JkcykuY2xhc3NMaXN0LnJlbW92ZSgnaW52YWxpZCcpO1xuICAgIH0pO1xuICAgIGNvbnN0ICRzaGlwQ29udGFpbmVycyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNoaXBzLWRpc3BsYXknKS5jaGlsZHJlbik7XG4gICAgJHNoaXBDb250YWluZXJzLmZvckVhY2goJHNoaXBDb250YWluZXIgPT4gJHNoaXBDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc3VuaycpKTtcbiAgICBjdXJyZW50ID0ge1xuICAgICAgc2hpcE51bTogMCxcbiAgICAgIHNoaXBDb29yZHNBcnJheTogW10sXG4gICAgICBheGlzOiAneCdcbiAgICB9O1xuICAgICRwbGF5QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIH1cbiAgXG4gIGNvbnN0IGdldFNhbXBsZVBsYXllciA9ICgpID0+IHBsYXllcjtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIFVJLnJlbmRlckdhbWVib2FyZChwbGF5ZXIubmFtZSwgcGxheWVyLmdhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgICBVSS51cGRhdGVTaGlwc0Rpc3BsYXkocGxheWVyLm5hbWUsIHNoaXBzKTtcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKHsga2V5IH0pID0+IHtcbiAgICAgIGlmIChrZXkgPT09ICdSJyB8fCBrZXkgPT09ICdyJykge1xuICAgICAgICBjdXJyZW50LmF4aXMgPSBjdXJyZW50LmF4aXMgPT09ICd4JyA/ICd5JzogJ3gnO1xuICAgICAgICBzaG93U2hpcChjdXJyZW50LnNoaXBDb29yZHNBcnJheVswXSwgY3VycmVudC5heGlzKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICRwbGF5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgJG1vZGFsLnJlbW92ZSgpO1xuICAgICAgR2FtZUNvbnRyb2xsZXIuaW5pdCgpO1xuICAgIH0pXG5cbiAgICAkcmVzZXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZXNldCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gICAgcGxhY2VTaGlwLFxuICAgIHNob3dTaGlwLFxuICAgIGdldFNhbXBsZVBsYXllcixcbiAgfVxuXG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBQbGFjZVNoaXBzOyIsIi8vIGltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tIFwiLi9Nb2R1bGVzL0dhbWVDb250cm9sbGVyXCI7XG5pbXBvcnQgUGxhY2VTaGlwcyBmcm9tIFwiLi9Nb2R1bGVzL1BsYWNlU2hpcHNcIjtcblxuUGxhY2VTaGlwcy5pbml0KCk7Il0sIm5hbWVzIjpbInNpemUiLCJzaGlwcyIsInN1bmsiLCJib2FyZCIsImFyciIsImkiLCJwdXNoIiwiY29vcmRzIiwieCIsInkiLCJNYXRoIiwiZmxvb3IiLCJoYXNTaGlwIiwiaXNTaG90IiwiX21ha2VHcmlkIiwiYXQiLCJpc1ZhbGlkQXR0YWNrIiwiaXNTaGlwSGl0IiwicmVjZWl2ZUF0dGFjayIsImNlbGwiLCJzaGlwTmFtZSIsInNoaXAiLCJmaW5kIiwibmFtZSIsImhpdCIsImlzU3VuayIsInNoaXBIaXQiLCJzZXRTaGlwIiwiYXhpcyIsIm5ld0Nvb3JkcyIsImdldExlbmd0aCIsImdldFNoaXBDb29yZHNBcnJheSIsImZpbHRlciIsIm1hcCIsImlzQ29sbGlzaW9ucyIsInNoaXBDb29yZHNBcnJheSIsInNoaXBDb29yZHMiLCJhZGphY2VudENvb3JkcyIsImdldFNoaXBCeUNvb3JkcyIsImdldEJvYXJkIiwiZ2V0U2hpcHMiLCJyZXNldCIsImFsbFNoaXBzU3VuayIsImxlbmd0aCIsImRpc3BsYXlOYW1lIiwiZ2FtZWJvYXJkIiwiaXNBY3RpdmUiLCIkZ2FtZWJvYXJkc0NvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIiRtb2RhbCIsIiR3aW5Nb2RhbCIsIm1vZGUiLCJkZWNvZGVDb29yZHMiLCJjb29yZHNTdHJpbmciLCJjb29yZHNBcnJheSIsInNwbGl0IiwiY3JlYXRlSHRtbEVsZW1lbnQiLCJ0eXBlIiwiY2xhc3NBcnJheSIsInRleHQiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImZvckVhY2giLCJjbHMiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInJlbmRlckdhbWVib2FyZCIsInBsYXllck5hbWUiLCIkY29udGFpbmVyIiwiYXBwZW5kQ2hpbGQiLCJuZXdHYW1lYm9hcmRDb250YWluZXJET00iLCJmaXJzdENoaWxkIiwiJGNlbGwiLCJzZXRBdHRyaWJ1dGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0QXR0cmlidXRlIiwiYWRkQ2VsbExpc3RlbmVyIiwibmV3Q2VsbERPTSIsInVwZGF0ZVNoaXBzRGlzcGxheSIsInNoaXBOdW0iLCIkc2hpcHNEaXNwbGF5IiwibmV4dEVsZW1lbnRTaWJsaW5nIiwiaW5kZXgiLCJpc1BsYWNlZCIsIiRzaGlwQ29udGFpbmVyIiwiJHNoaXBCb2R5IiwibmV3U2hpcERPTSIsImNlbGxIaXQiLCJjb25zb2xlIiwibG9nIiwiZW5jb2RlZENvb3JkcyIsInNoaXBTdW5rIiwidG9nZ2xlQWN0aXZlQm9hcmQiLCJBcnJheSIsImZyb20iLCJjaGlsZHJlbiIsIiRnYW1lYm9hcmRDb250YWluZXIiLCJjb250YWlucyIsInRvZ2dsZSIsInNob3dXaW5uZXIiLCJwbGF5ZXJEaXNwbGF5TmFtZSIsInNoaXBMZW5ndGgiLCJoaXRDb3VudCIsImdldEhpdHMiLCJBSXBsYXllciIsInByZXZTaGlwSGl0IiwiZ2V0UmFuZG9tVmFsaWRDb29yZHMiLCJ2YWxpZENlbGxzIiwicmFuZG9tIiwic3VtIiwib2JqMSIsIm9iajIiLCJzdWJ0cmFjdCIsIk9iamVjdCIsImtleXMiLCJyZWR1Y2UiLCJhY2N1bXVsYXRvciIsImtleSIsImdldENvb3JkcyIsImFycmF5IiwicmkiLCJzaHVmZmxlRmlzaGVyWWF0ZXMiLCJhZGphY2VuY3kiLCJhZGphY2VudCIsIm5ld1BvaW50IiwiZ2V0VmFsaWRBZGphY2VudENvb3JkcyIsImRpcmVjdGlvbiIsInRyYWNlTGFzdFNoaXBIaXQiLCJnZXRBSVBsYXllciIsInBsYXllcjEiLCJwbGF5ZXIyIiwic2xlZXAiLCJtcyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsIm9wcG9uZW50IiwicGxheVR1cm4iLCJhc3luYyIsIm9wcG9uZW50Qm9hcmQiLCJwbGF5R2FtZSIsImluaXQiLCJwbGF5ZXIiLCJjdXJyZW50IiwiJHBsYXlCdXR0b24iLCIkcmVzZXRCdXR0b24iLCJjZWxsQXQiLCJzaG93U2hpcCIsInJlbW92ZSIsIm1ha2VTaGlwIiwiaXNTaGlwVmFsaWQiLCJzdHlsZSIsImRpc3BsYXkiLCJwbGFjZVNoaXAiLCJnZXRTYW1wbGVQbGF5ZXIiXSwic291cmNlUm9vdCI6IiJ9